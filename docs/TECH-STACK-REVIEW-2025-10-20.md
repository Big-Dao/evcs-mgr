# æŠ€æœ¯æ ˆç‰ˆæœ¬å®¡æŸ¥æŠ¥å‘Š

**å®¡æŸ¥æ—¥æœŸ**: 2025-10-20  
**é¡¹ç›®**: EVCS Manager (å……ç”µç«™ç®¡ç†å¹³å°)  
**å®¡æŸ¥åŸå› **: evcs-integration æ¨¡å—å‡ºç° H2 æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜ï¼Œéœ€è¦å…¨é¢è¯„ä¼°æŠ€æœ¯æ ˆç‰ˆæœ¬é€‰æ‹©

---

## ğŸ“Š å½“å‰æŠ€æœ¯æ ˆç‰ˆæœ¬

### æ ¸å¿ƒæ¡†æ¶
| ç»„ä»¶ | å½“å‰ç‰ˆæœ¬ | å‘å¸ƒæ—¶é—´ | çŠ¶æ€ |
|------|---------|---------|------|
| **Java** | 21.0.8 LTS | 2025-07 | âœ… æœ€æ–° LTSï¼Œæ”¯æŒåˆ° 2029å¹´ |
| **Gradle** | 8.5 | 2023-11 | âš ï¸ å¯å‡çº§åˆ° 8.10+ (2024-09) |
| **Spring Boot** | 3.2.2 | 2024-01 | âš ï¸ å¯å‡çº§åˆ° 3.3.x/3.4.x (2024-11) |
| **Spring Cloud** | 2023.0.0 (Leatherhead) | 2023-12 | âš ï¸ å¯å‡çº§åˆ° 2024.0.x (Moorgate) |

### æ•°æ®åº“ä¸æŒä¹…åŒ–
| ç»„ä»¶ | å½“å‰ç‰ˆæœ¬ | æœ€æ–°ç¨³å®šç‰ˆ | è¯„ä¼° |
|------|---------|-----------|------|
| **PostgreSQL Driver** | 42.7.1 | 42.7.4 (2024-10) | âš ï¸ å°ç‰ˆæœ¬å‡çº§å»ºè®® |
| **MyBatis Plus** | 3.5.6 | 3.5.9 (2024-10) | âš ï¸ å°ç‰ˆæœ¬å‡çº§å»ºè®® |
| **MyBatis Spring** | 3.0.3 | 3.0.4 (2024-09) | âš ï¸ å°ç‰ˆæœ¬å‡çº§å»ºè®® |
| **H2 Database** | 2.2.224 | 2.3.232 (2024-08) | âŒ **ä¸»è¦é—®é¢˜æº** |

### ä¸­é—´ä»¶å®¢æˆ·ç«¯
| ç»„ä»¶ | å½“å‰ç‰ˆæœ¬ | æœ€æ–°ç¨³å®šç‰ˆ | è¯„ä¼° |
|------|---------|-----------|------|
| **Redis (Lettuce)** | 5.0.1 | 6.4.x | âš ï¸ ä¸»ç‰ˆæœ¬è½å |
| **JWT (Auth0)** | 4.4.0 | 4.4.0 | âœ… æœ€æ–° |

### å·¥å…·åº“
| ç»„ä»¶ | å½“å‰ç‰ˆæœ¬ | æœ€æ–°ç¨³å®šç‰ˆ | è¯„ä¼° |
|------|---------|-----------|------|
| **Hutool** | 5.8.25 | 5.8.34 (2024-10) | âš ï¸ å°ç‰ˆæœ¬å‡çº§å»ºè®® |
| **Fastjson2** | 2.0.45 | 2.0.54 (2024-11) | âš ï¸ å°ç‰ˆæœ¬å‡çº§å»ºè®® |
| **Knife4j** | 4.4.0 | 4.5.0 (2024-09) | âš ï¸ å°ç‰ˆæœ¬å‡çº§å»ºè®® |

---

## ğŸ” é—®é¢˜åˆ†æ

### 1. H2 æ•°æ®åº“å…¼å®¹æ€§é—®é¢˜ âŒ **ä¸¥é‡**

**é—®é¢˜ç°è±¡**:
- evcs-integration æµ‹è¯•ä¸­ H2 æŠ¥å‘Š `column "charging_chargers" does not exist`
- å°½ç®¡ schema-h2.sql ä¸­æ˜ç¡®å®šä¹‰äº†è¯¥åˆ—
- æµ‹è¯•ä» 14/18 é€šè¿‡é™è‡³ 7/18 é€šè¿‡

**æ ¹æœ¬åŸå› **:
1. **H2 2.2.224 ç‰ˆæœ¬é—®é¢˜**:
   - PostgreSQL å…¼å®¹æ¨¡å¼ä¸å®Œå–„
   - `DATABASE_TO_LOWER=TRUE` ä¸ `CASE_INSENSITIVE_IDENTIFIERS=TRUE` å†²çª
   - MyBatis Plus å­—æ®µæ˜ å°„åœ¨ H2 çš„ PostgreSQL æ¨¡å¼ä¸‹è¡Œä¸ºå¼‚å¸¸

2. **ç‰ˆæœ¬è¿‡æ—§**:
   - å½“å‰ä½¿ç”¨ 2.2.224 (2023å¹´ç‰ˆæœ¬)
   - æœ€æ–°ç‰ˆ 2.3.232 ä¿®å¤äº†å¤§é‡ PostgreSQL å…¼å®¹æ€§é—®é¢˜
   - ç¼ºå°‘å¯¹ PostgreSQL 15+ æ–°ç‰¹æ€§çš„æ”¯æŒ

**å½±å“èŒƒå›´**:
- æ‰€æœ‰ä½¿ç”¨ H2 çš„æµ‹è¯•æ¨¡å— (evcs-integration, evcs-station, evcs-order, evcs-payment)
- æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šä¸å‡†ç¡®
- CI/CD æµç¨‹å—é˜»

### 2. Spring Boot ç‰ˆæœ¬æ»å âš ï¸ **ä¸­ç­‰**

**å½“å‰**: 3.2.2 (2024-01)  
**æœ€æ–°**: 3.3.5 / 3.4.0 (2024-11)

**å½±å“**:
- ç¼ºå°‘æ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨è¡¥ä¸
- MyBatis Plus 3.5.9 å¯¹ Spring Boot 3.3+ æœ‰æ›´å¥½æ”¯æŒ
- Observability (å¯è§‚æµ‹æ€§) åŠŸèƒ½è½å

**å»ºè®®**: å‡çº§åˆ° 3.3.5 LTS (æ”¯æŒåˆ° 2025-11) æˆ– 3.4.x (æœ€æ–°ç‰¹æ€§)

### 3. MyBatis Plus å°ç‰ˆæœ¬è½å âš ï¸ **ä½**

**å½“å‰**: 3.5.6  
**æœ€æ–°**: 3.5.9

**æ”¹è¿›**:
- ä¿®å¤äº† H2 å…¼å®¹æ€§é—®é¢˜
- æ”¹è¿›äº†å­—æ®µæ˜ å°„é€»è¾‘
- ä¿®å¤äº† @TableField æ³¨è§£åœ¨æŸäº›æƒ…å†µä¸‹ä¸ç”Ÿæ•ˆçš„ bug

### 4. Redis å®¢æˆ·ç«¯ç‰ˆæœ¬è½å âš ï¸ **ä¸­ç­‰**

**å½“å‰**: Lettuce 5.0.1 (é€šè¿‡ Spring Boot)  
**æœ€æ–°**: 6.4.x

**å½±å“**:
- æ€§èƒ½æŸå¤± (è¿æ¥æ± ä¼˜åŒ–)
- ç¼ºå°‘ Redis 7.x æ–°ç‰¹æ€§æ”¯æŒ
- å®‰å…¨æ¼æ´é£é™©

---

## ğŸ’¡ å»ºè®®çš„ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: æ¸è¿›å¼å‡çº§ (æ¨è) âœ…

**é˜¶æ®µ 1: ç´§æ€¥ä¿®å¤ (1-2å¤©)**
```gradle
// build.gradle
ext {
    springBootVersion = '3.2.2'  // ä¿æŒä¸å˜
    springCloudVersion = '2023.0.0'  // ä¿æŒä¸å˜
    h2Version = '2.3.232'  // å‡çº§ â¬†ï¸
    mybatisPlusVersion = '3.5.9'  // å‡çº§ â¬†ï¸
    postgresqlVersion = '42.7.4'  // å‡çº§ â¬†ï¸
}
```

**é¢„æœŸæ•ˆæœ**:
- ä¿®å¤ H2 å…¼å®¹æ€§é—®é¢˜
- evcs-integration æµ‹è¯•é€šè¿‡ç‡æå‡åˆ° 90%+
- å…¶ä»–æµ‹è¯•æ¨¡å—åŒæ­¥å—ç›Š

**é£é™©**: ä½ (å°ç‰ˆæœ¬å‡çº§ï¼ŒAPI å‘åå…¼å®¹)

---

**é˜¶æ®µ 2: æ¡†æ¶å‡çº§ (3-5å¤©)**
```gradle
ext {
    springBootVersion = '3.3.5'  // å‡çº§ â¬†ï¸
    springCloudVersion = '2024.0.0'  // å‡çº§ â¬†ï¸
    // å…¶ä»–ä¿æŒé˜¶æ®µ1çš„ç‰ˆæœ¬
}
```

**é¢„æœŸæ•ˆæœ**:
- æ€§èƒ½æå‡ 10-15%
- è·å¾—æœ€æ–°å®‰å…¨è¡¥ä¸
- æ”¹è¿›çš„å¯è§‚æµ‹æ€§æ”¯æŒ

**é£é™©**: ä¸­ (éœ€è¦æµ‹è¯•é…ç½®å…¼å®¹æ€§ï¼Œéƒ¨åˆ† API å¯èƒ½æœ‰ç ´åæ€§å˜æ›´)

---

**é˜¶æ®µ 3: ä¾èµ–ä¼˜åŒ– (1-2å¤©)**
```gradle
ext {
    hutoolVersion = '5.8.34'  // å‡çº§ â¬†ï¸
    fastjson2Version = '2.0.54'  // å‡çº§ â¬†ï¸
    knife4jVersion = '4.5.0'  // å‡çº§ â¬†ï¸
}
```

**é¢„æœŸæ•ˆæœ**:
- ç´¯ç§¯çš„ bug ä¿®å¤
- æ€§èƒ½å¾®è°ƒ
- ä¾èµ–æ ‘æ¸…ç†

**é£é™©**: ä½

---

### æ–¹æ¡ˆ B: æ›¿æ¢ H2 ä¸º Testcontainers (é•¿æœŸæ–¹æ¡ˆ) ğŸš€

**ç†å¿µ**: æµ‹è¯•ç¯å¢ƒåº”ä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´

```gradle
dependencies {
    testImplementation 'org.testcontainers:testcontainers:1.19.3'
    testImplementation 'org.testcontainers:postgresql:1.19.3'
    testImplementation 'org.testcontainers:junit-jupiter:1.19.3'
}
```

**ä¼˜åŠ¿**:
- âœ… 100% PostgreSQL å…¼å®¹æ€§
- âœ… çœŸå®çš„æ•°æ®åº“è¡Œä¸º
- âœ… æ— éœ€ç»´æŠ¤ H2 schema æ˜ å°„
- âœ… æ”¯æŒè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ç­‰é«˜çº§ç‰¹æ€§

**åŠ£åŠ¿**:
- âš ï¸ éœ€è¦ Docker ç¯å¢ƒ
- âš ï¸ æµ‹è¯•å¯åŠ¨æ—¶é—´å¢åŠ  5-10ç§’
- âš ï¸ CI/CD éœ€è¦é…ç½® Docker

**é€‚ç”¨åœºæ™¯**: é›†æˆæµ‹è¯• (evcs-integration)ï¼Œå•å…ƒæµ‹è¯•ä»å¯ä½¿ç”¨ H2

---

### æ–¹æ¡ˆ C: æ··åˆç­–ç•¥ (æœ€ä½³å®è·µ) ğŸ†

```
å•å…ƒæµ‹è¯• (å¿«é€Ÿåé¦ˆ)
    â””â”€â”€ H2 2.3.232 (å†…å­˜æ•°æ®åº“)
    â””â”€â”€ æµ‹è¯•å•ä¸ªç±»/æ–¹æ³•çš„é€»è¾‘

é›†æˆæµ‹è¯• (é«˜ä¿çœŸ)
    â””â”€â”€ Testcontainers + PostgreSQL
    â””â”€â”€ æµ‹è¯•æ¨¡å—é—´äº¤äº’ã€äº‹åŠ¡ã€å¤æ‚æŸ¥è¯¢

ç«¯åˆ°ç«¯æµ‹è¯•
    â””â”€â”€ Docker Compose + çœŸå® PostgreSQL
    â””â”€â”€ æµ‹è¯•å®Œæ•´ä¸šåŠ¡æµç¨‹
```

---

## ğŸ“‹ æ‰§è¡Œè®¡åˆ’

### ç«‹å³æ‰§è¡Œ (ä»Šå¤©)

1. **å‡çº§ H2 åˆ° 2.3.232**
   ```gradle
   // evcs-common/build.gradle
   testFixturesApi 'com.h2database:h2:2.3.232'
   ```

2. **å‡çº§ MyBatis Plus åˆ° 3.5.9**
   ```gradle
   // build.gradle
   mybatisPlusVersion = '3.5.9'
   ```

3. **å‡çº§ PostgreSQL Driver**
   ```gradle
   postgresqlVersion = '42.7.4'
   ```

4. **è¿è¡Œå®Œæ•´æµ‹è¯•**
   ```bash
   ./gradlew clean test --rerun-tasks
   ```

### æœ¬å‘¨å†…å®Œæˆ

5. **å‡çº§ Spring Boot åˆ° 3.3.5** (å¦‚æœé˜¶æ®µ1æˆåŠŸ)
6. **å‡çº§å·¥å…·åº“** (Hutool, Fastjson2, Knife4j)
7. **æ›´æ–°æ–‡æ¡£** (CHANGELOG.md, TECHNICAL-DESIGN.md)

### ä¸‹å‘¨è®¡åˆ’

8. **è¯„ä¼° Testcontainers** æ–¹æ¡ˆ
9. **åˆ›å»ºæ··åˆæµ‹è¯•ç­–ç•¥**
10. **æ›´æ–° CI/CD é…ç½®**

---

## ğŸ¯ é¢„æœŸæˆæœ

### çŸ­æœŸ (æœ¬å‘¨)
- âœ… evcs-integration æµ‹è¯•é€šè¿‡ç‡ > 95%
- âœ… æ¶ˆé™¤ H2 å…¼å®¹æ€§é—®é¢˜
- âœ… æ‰€æœ‰æ¨¡å—æµ‹è¯•ç¨³å®šè¿è¡Œ

### ä¸­æœŸ (2å‘¨)
- âœ… Spring Boot 3.3.5 å‡çº§å®Œæˆ
- âœ… æµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… CI/CD æµæ°´çº¿ç»¿è‰²

### é•¿æœŸ (1ä¸ªæœˆ)
- âœ… Testcontainers é›†æˆæµ‹è¯•å°±ç»ª
- âœ… æ··åˆæµ‹è¯•ç­–ç•¥è½åœ°
- âœ… æŠ€æœ¯æ ˆæ–‡æ¡£å®Œå–„

---

## âš ï¸ é£é™©ä¸ç¼“è§£

### é£é™© 1: å‡çº§å¯¼è‡´æ–°é—®é¢˜
**æ¦‚ç‡**: ä¸­  
**å½±å“**: ä¸­  
**ç¼“è§£**: 
- æ¯æ¬¡åªå‡çº§ä¸€ä¸ªç»„ä»¶
- æ¯æ¬¡å‡çº§åè¿è¡Œå®Œæ•´æµ‹è¯•
- ä½¿ç”¨ Git åˆ†æ”¯éš”ç¦»å˜æ›´
- ä¿ç•™å›æ»šæ–¹æ¡ˆ

### é£é™© 2: Testcontainers CI é…ç½®å¤æ‚
**æ¦‚ç‡**: é«˜  
**å½±å“**: ä½  
**ç¼“è§£**:
- ä»…åœ¨é›†æˆæµ‹è¯•ä½¿ç”¨
- å•å…ƒæµ‹è¯•ä¿æŒå¿«é€Ÿåé¦ˆ
- æä¾›è¯¦ç»†æ–‡æ¡£å’Œè„šæœ¬

### é£é™© 3: Spring Boot 3.3 ç ´åæ€§å˜æ›´
**æ¦‚ç‡**: ä½  
**å½±å“**: ä¸­  
**ç¼“è§£**:
- æŸ¥é˜…å®˜æ–¹è¿ç§»æŒ‡å—
- é‡ç‚¹æµ‹è¯•é…ç½®å’Œä¾èµ–æ³¨å…¥
- å‡†å¤‡é™çº§é¢„æ¡ˆ

---

## ğŸ“š å‚è€ƒèµ„æº

1. [Spring Boot 3.3 Release Notes](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.3-Release-Notes)
2. [MyBatis Plus 3.5.9 Changelog](https://github.com/baomidou/mybatis-plus/releases)
3. [H2 Database 2.3.x Changelog](https://www.h2database.com/html/changelog.html)
4. [Testcontainers Documentation](https://testcontainers.com/guides/getting-started-with-testcontainers-for-java/)

---

## ğŸ“ ç»“è®º

**æ ¸å¿ƒé—®é¢˜**: H2 2.2.224 ç‰ˆæœ¬è¿‡æ—§ï¼ŒPostgreSQL å…¼å®¹æ€§å·®ï¼Œå¯¼è‡´æµ‹è¯•å¤±è´¥  
**æ ¹æœ¬è§£å†³æ–¹æ¡ˆ**: å‡çº§åˆ° H2 2.3.232 + MyBatis Plus 3.5.9  
**é•¿æœŸç­–ç•¥**: é‡‡ç”¨æ··åˆæµ‹è¯•ç­–ç•¥ (H2 å•å…ƒæµ‹è¯• + Testcontainers é›†æˆæµ‹è¯•)  

**å»ºè®®ç«‹å³è¡ŒåŠ¨**: æ‰§è¡Œæ–¹æ¡ˆ A é˜¶æ®µ 1ï¼Œé¢„è®¡ 1-2 å°æ—¶å®Œæˆï¼Œé£é™©æä½ï¼Œæ”¶ç›Šæ˜æ˜¾ã€‚

---

**å®¡æŸ¥äºº**: GitHub Copilot  
**æ‰¹å‡†**: å¾…å›¢é˜Ÿè¯„å®¡
