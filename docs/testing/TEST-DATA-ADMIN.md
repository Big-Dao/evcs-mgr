# Admin 用户测试数据生成报告

> **版本**: v1.0 | **最后更新**: 2025-11-10 | **维护者**: 测试数据管理员 | **状态**: 完成

## 执行时间
2025-10-31

## 用户信息
- **用户名**: admin
- **用户ID**: 1
- **租户ID**: 1
- **租户名称**: 系统租户 (SYSTEM)

## 生成的测试数据

### 1. 充电站 (5个)

由于数据库中其他租户已占用了大量station_id（最大ID达210017），无法批量插入新站点。
当前admin租户拥有5个充电站：

| ID | 站点编码 | 站点名称 |
|----|---------|---------|
| 1  | ST001   | 市中心充电站 |
| 2  | ST002   | 商业中心充电站 |
| 3  | ST003   | 住宅区充电站 |
| 4  | ST004   | 高速服务区充电站 |
| 5  | ST005   | 办公楼充电站 |

### 2. 充电桩 (40个)

为5个充电站各配置了8个充电桩（5个快充 + 3个慢充），共40个。

**配置详情**:
- **快充桩** (5个/站): DC直流，功率130-180kW，双枪位
- **慢充桩** (3个/站): AC交流，功率7-11kW，单枪位
- **品牌分布**: 特来电、星星充电、云快充、ABB
- **状态分布**: 
  - 运营中: ~75%
  - 充电中: ~15%
  - 维护中: ~10%

### 3. 计费方案 (33个)

包含30个系统生成的计费方案 + 3个原有方案。

**方案类型**:
- 标准计费方案
- 峰谷电价方案  
- 快充/慢充专属方案
- VIP会员方案
- 节假日促销方案
- 夜间优惠方案
- 企业合作方案

**每个方案包含3个时段**:
1. **谷时** (00:00-08:00): 电价 ~0.50元/kWh, 服务费 ~0.30元/kWh
2. **平时** (08:00-18:00): 电价 ~0.80元/kWh, 服务费 ~0.40元/kWh
3. **峰时** (18:00-24:00): 电价 ~1.20元/kWh, 服务费 ~0.50元/kWh

### 4. 计费时段 (213个)

33个计费方案 × 每个3个时段，外加部分历史数据 = 213个时段配置。

### 5. 充电订单 (318个)

超过目标数量的充电订单，涵盖最近30天的充电记录。

**订单状态分布**:
| 状态 | 数量 | 百分比 |
|------|------|--------|
| 已取消 | 14 | 4.4% |
| 充电中 | 20 | 6.3% |
| 待支付 | 38 | 11.9% |
| 已支付 | 246 | 77.4% |

**订单特征**:
- 充电时长: 3-180分钟不等
- 充电电量: 10-60 kWh不等  
- 订单金额: 根据电量和计费方案计算
- 支付方式: 支付宝、微信、余额等
- 时间分布: 覆盖最近30天

## 数据访问

使用 **admin** 账号登录后，可以在以下页面查看数据：

1. **充电站管理** (`http://localhost:3000/stations`)
   - 可以看到5个充电站
   - 每个站点显示充电桩数量、运营状态等信息

2. **充电桩管理** (`http://localhost:3000/chargers`)
   - 可以看到40个充电桩
   - 显示快充、慢充等不同类型
   - 显示实时状态（运营中、充电中、维护中）

3. **充电订单** (`http://localhost:3000/orders`)
   - 可以看到318个订单
   - 包含已支付、待支付、充电中、已取消等不同状态
   - 显示充电量、时长、金额等详细信息

4. **计费方案** (`http://localhost:3000/billing-plans`)
   - 可以看到33个计费方案
   - 每个方案包含分时段的电价和服务费配置

## API 验证

可以使用以下命令验证数据：

```powershell
# 查询充电站
curl -s "http://localhost:8082/station/page?current=1&size=10" -H "X-User-Id: 1" -H "X-Tenant-Id: 1"

# 查询充电桩
curl -s "http://localhost:8082/charger/page?current=1&size=10" -H "X-User-Id: 1" -H "X-Tenant-Id: 1"

# 查询订单
curl -s "http://localhost:8083/order/page?page=1&size=10" -H "X-User-Id: 1" -H "X-Tenant-Id: 1"

# 查询计费方案
curl -s "http://localhost:8083/billing/plans/page?current=1&size=10" -H "X-User-Id: 1" -H "X-Tenant-Id: 1"
```

## 技术说明

### 遇到的挑战

1. **主键冲突问题**: 数据库中其他租户已创建大量数据，导致自增主键冲突
   - 解决方案: 基于现有数据补充，而非大批量新增

2. **表结构差异**: 实际表结构与预期不同
   - `charging_station`: 主键是 `station_id` 而非 `id`
   - `charger`: 主键是 `charger_id`
   - `billing_plan_segment`: 字段名为 `segment_index` 而非 `name`
   - `charging_order`: 字段包括 `duration`、`energy`、`amount`，而非 `charging_duration`、`energy_consumed`、`energy_cost`、`service_cost`

3. **数据一致性**: 确保所有外键关系正确
   - 充电桩必须关联到有效的充电站
   - 订单必须关联到有效的充电站、充电桩和计费方案

### 生成方法

使用PostgreSQL的 `generate_series` 函数批量生成数据，配合CROSS JOIN实现一对多关系的数据生成。

## 文件位置

SQL 脚本保存在:
- `sql/test-data-admin-supplement.sql` - 补充数据脚本（最终版本）
- `sql/test-data-admin-final.sql` - 完整生成脚本（有主键冲突问题）

## 数据特点

1. **多租户隔离**: 所有数据都属于租户ID=1，与其他租户完全隔离
2. **真实业务场景**: 涵盖不同类型的充电站、充电桩和订单状态
3. **时间维度**: 订单跨越最近30天，便于测试时间筛选功能
4. **状态多样性**: 包含运营中、充电中、维护中、已支付、待支付等多种状态
5. **数据量级**: 符合实际使用场景的数据量，便于性能测试

## 后续建议

如需进一步增加充电站数量，可以考虑：
1. 使用事务插入，在失败时回滚
2. 预先查询可用的ID范围
3. 或者清空其他测试租户的数据以释放ID空间

当前的数据量已足够用于功能测试和演示使用。
