# EVCSé¡¹ç›®ä»£ç è´¨é‡æ£€æŸ¥æ¸…å•

> **ç‰ˆæœ¬**: v1.1 | **æœ€åæ›´æ–°**: 2025-11-10 | **ç»´æŠ¤è€…**: æŠ€æœ¯è´Ÿè´£äºº | **çŠ¶æ€**: æ´»è·ƒ
>
> âœ… **ç”¨é€”**: ç»Ÿä¸€ä»£ç å®¡æŸ¥ã€è´¨é‡ä¿éšœä¸è‡ªåŠ¨åŒ–éªŒæ”¶è¦æ±‚

## ğŸ¯ æ£€æŸ¥æ¸…å•æ¦‚è¿°

æœ¬æ£€æŸ¥æ¸…å•ç¡®ä¿EVCSé¡¹ç›®çš„ä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œæ€§èƒ½ç¬¦åˆæ ‡å‡†ï¼Œé€‚ç”¨äºæ‰€æœ‰AIç¼–ç¨‹åŠ©æ‰‹å’Œå¼€å‘äººå‘˜ã€‚

## ğŸ“‹ æ£€æŸ¥æ¸…å•åˆ†ç±»

### ğŸ”´ å¼ºåˆ¶è¦æ±‚ (å¿…é¡»æ»¡è¶³)

#### æ¶æ„å’Œè®¾è®¡
- [ ] **å¾®æœåŠ¡è¾¹ç•Œ**: ä¸¥æ ¼éµå¾ªæœåŠ¡è¾¹ç•Œï¼Œä¸å¾—è·¨æœåŠ¡ç›´æ¥è®¿é—®æ•°æ®åº“
- [ ] **DDDåˆ†å±‚**: Controller â†’ Service â†’ Repository â†’ Entityåˆ†å±‚æ¸…æ™°
- [ ] **å¾ªç¯ä¾èµ–**: ä¸å­˜åœ¨æ¨¡å—é—´çš„å¾ªç¯ä¾èµ–
- [ ] **å•ä¸€èŒè´£**: æ¯ä¸ªç±»å’Œæ–¹æ³•èŒè´£å•ä¸€æ˜ç¡®

#### å®‰å…¨è¦æ±‚
- [ ] **è¾“å…¥éªŒè¯**: æ‰€æœ‰APIè¾“å…¥ä½¿ç”¨`@Valid`æˆ–`@Validated`éªŒè¯
- [ ] **è®¤è¯æˆæƒ**: æ‰€æœ‰APIåŒ…å«`@PreAuthorize`æƒé™æ£€æŸ¥
- [ ] **å¯†ç åŠ å¯†**: ä½¿ç”¨`BCryptPasswordEncoder`åŠ å¯†å¯†ç 
- [ ] **æ•æ„Ÿä¿¡æ¯**: æ•æ„Ÿé…ç½®ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸ç¡¬ç¼–ç 
- [ ] **SQLå®‰å…¨**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œé˜²æ­¢SQLæ³¨å…¥
- [ ] **JWTå®‰å…¨**: JWTå¯†é’¥ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®

#### äº‹åŠ¡å’Œæ•°æ®ä¸€è‡´æ€§
- [ ] **äº‹åŠ¡ç®¡ç†**: æ›´æ–°æ“ä½œä½¿ç”¨`@Transactional`æ³¨è§£
- [ ] **ç¼“å­˜ä¸€è‡´æ€§**: æ›´æ–°æ“ä½œä½¿ç”¨`@CacheEvict`å¤±æ•ˆç¼“å­˜
- [ ] **ç§Ÿæˆ·éš”ç¦»**: å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»æ­£ç¡®å®ç°
- [ ] **å®¡è®¡å­—æ®µ**: å®ä½“åŒ…å«åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ç­‰å®¡è®¡å­—æ®µ

#### å¼‚å¸¸å¤„ç†
- [ ] **å…¨å±€å¼‚å¸¸å¤„ç†**: ä½¿ç”¨`@ControllerAdvice`ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- [ ] **ä¸šåŠ¡å¼‚å¸¸**: è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼Œä¸æŠ›å‡ºåŸå§‹å¼‚å¸¸
- [ ] **æ—¥å¿—è®°å½•**: å¼‚å¸¸æƒ…å†µæ­£ç¡®è®°å½•æ—¥å¿—
- [ ] **ç©ºcatchå—**: ä¸å…è®¸ç©ºçš„catchå—

#### ä»£ç è§„èŒƒ
- [ ] **å‘½åè§„èŒƒ**: éµå¾ªJavaå‘½åçº¦å®š
- [ ] **æ³¨é‡Šè¦æ±‚**: å…¬å…±APIåŒ…å«JavaDocæ³¨é‡Š
- [ ] **ä»£ç æ ¼å¼**: éµå¾ªé¡¹ç›®ä»£ç æ ¼å¼è§„èŒƒ
- [ ] **é­”æ³•å€¼**: ä¸ä½¿ç”¨é­”æ³•æ•°å­—å’Œå­—ç¬¦ä¸²

### ğŸŸ¡ é‡è¦è¦æ±‚ (å¼ºçƒˆæ¨è)

#### æ€§èƒ½ä¼˜åŒ–
- [ ] **N+1æŸ¥è¯¢**: é¿å…N+1æŸ¥è¯¢é—®é¢˜
- [ ] **ç¼“å­˜ä½¿ç”¨**: åˆç†ä½¿ç”¨Spring Cache
- [ ] **åˆ†é¡µæŸ¥è¯¢**: å¤§æ•°æ®é‡æŸ¥è¯¢ä½¿ç”¨åˆ†é¡µ
- [ ] **å¼‚æ­¥å¤„ç†**: è€—æ—¶æ“ä½œä½¿ç”¨`@Async`
- [ ] **èµ„æºç®¡ç†**: ä½¿ç”¨try-with-resourcesç®¡ç†èµ„æº
- [ ] **æ•°æ®åº“è¿æ¥**: åˆç†é…ç½®æ•°æ®åº“è¿æ¥æ± 

#### æµ‹è¯•è¦†ç›–
- [ ] **å•å…ƒæµ‹è¯•**: Serviceå±‚å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >= 80%
- [ ] **é›†æˆæµ‹è¯•**: Controllerå±‚é›†æˆæµ‹è¯•è¦†ç›–ç‡ >= 70%
- [ ] **è¾¹ç•Œæµ‹è¯•**: åŒ…å«è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µæµ‹è¯•
- [ ] **æµ‹è¯•å‘½å**: æµ‹è¯•æ–¹æ³•å‘½åæ¸…æ™°ï¼Œä½¿ç”¨`@DisplayName`

#### æ—¥å¿—å’Œç›‘æ§
- [ ] **æ—¥å¿—çº§åˆ«**: åˆç†ä½¿ç”¨æ—¥å¿—çº§åˆ«
- [ ] **æ—¥å¿—å†…å®¹**: æ—¥å¿—ä¿¡æ¯åŒ…å«å¿…è¦çš„ä¸Šä¸‹æ–‡
- [ ] **æ€§èƒ½ç›‘æ§**: å…³é”®æ“ä½œåŒ…å«æ€§èƒ½ç›‘æ§
- [ ] **å¥åº·æ£€æŸ¥**: å®ç°Spring Boot Actuatorå¥åº·æ£€æŸ¥

### ğŸŸ¢ å»ºè®®è¦æ±‚ (æ¨èéµå¾ª)

#### ä»£ç å¯ç»´æŠ¤æ€§
- [ ] **æ–¹æ³•é•¿åº¦**: å•ä¸ªæ–¹æ³•ä¸è¶…è¿‡50è¡Œ
- [ ] **ç±»é•¿åº¦**: å•ä¸ªç±»ä¸è¶…è¿‡500è¡Œ
- [ ] **å‚æ•°æ•°é‡**: æ–¹æ³•å‚æ•°ä¸è¶…è¿‡5ä¸ª
- [ ] **å¤æ‚åº¦**: é¿å…è¿‡äºå¤æ‚çš„åµŒå¥—é€»è¾‘

#### æ–‡æ¡£å’Œæ³¨é‡Š
- [ ] **READMEæ›´æ–°**: æ–°åŠŸèƒ½æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] **APIæ–‡æ¡£**: é‡è¦APIåŒ…å«ä½¿ç”¨ç¤ºä¾‹
- [ ] **é…ç½®è¯´æ˜**: å¤æ‚é…ç½®åŒ…å«è¯´æ˜æ³¨é‡Š
- [ ] **å˜æ›´æ—¥å¿—**: é‡è¦å˜æ›´è®°å½•åœ¨CHANGELOGä¸­

## ğŸ” è¯¦ç»†æ£€æŸ¥æ ‡å‡†

### Controllerå±‚æ£€æŸ¥

#### âœ… æ­£ç¡®å®ç°
```java
@RestController
@RequestMapping("/api/v1/orders")
@Validated
@Slf4j
public class OrderController {

    private final OrderService orderService;

    @PostMapping
    @PreAuthorize("hasPermission('order', 'create')")
    public ResponseEntity<ApiResponse<OrderDTO>> create(
            @Valid @RequestBody CreateOrderRequest request) {
        try {
            OrderDTO result = orderService.create(request);
            return ResponseEntity.status(HttpStatus.CREATED)
                .body(ApiResponse.success(result));
        } catch (BusinessException e) {
            log.warn("åˆ›å»ºè®¢å•å¤±è´¥: {}", e.getMessage());
            return ResponseEntity.badRequest()
                .body(ApiResponse.error(e.getMessage()));
        } catch (Exception e) {
            log.error("åˆ›å»ºè®¢å•å¼‚å¸¸", e);
            return ResponseEntity.internalServerError()
                .body(ApiResponse.error("ç³»ç»Ÿå†…éƒ¨é”™è¯¯"));
        }
    }
}
```

#### âŒ å¸¸è§é”™è¯¯
```java
// é”™è¯¯1: ç¼ºå°‘æƒé™æ£€æŸ¥
@PostMapping
public ResponseEntity<?> create(@RequestBody CreateOrderRequest request) {
    // ç¼ºå°‘@PreAuthorizeæ³¨è§£
}

// é”™è¯¯2: ç¼ºå°‘è¾“å…¥éªŒè¯
@PostMapping
public ResponseEntity<?> create(@RequestBody CreateOrderRequest request) {
    // ç¼ºå°‘@Validæ³¨è§£
}

// é”™è¯¯3: å¼‚å¸¸å¤„ç†ä¸å½“
@PostMapping
public ResponseEntity<?> create(@RequestBody CreateOrderRequest request) {
    try {
        return ResponseEntity.ok(orderService.create(request));
    } catch (Exception e) {
        return ResponseEntity.internalServerError().build(); // ä¿¡æ¯ä¸¢å¤±
    }
}

// é”™è¯¯4: ä¸šåŠ¡é€»è¾‘åœ¨Controller
@PostMapping
public ResponseEntity<?> create(@RequestBody CreateOrderRequest request) {
    if (request.getAmount().compareTo(BigDecimal.ZERO) <= 0) {
        return ResponseEntity.badRequest().build(); // ä¸šåŠ¡é€»è¾‘åº”è¯¥åœ¨Serviceå±‚
    }
}
```

### Serviceå±‚æ£€æŸ¥

#### âœ… æ­£ç¡®å®ç°
```java
@Service
@Transactional
@Slf4j
public class OrderService {

    private final OrderRepository orderRepository;
    private final RedisTemplate<String, Object> redisTemplate;

    @Cacheable(value = "orders", key = "#id")
    @DataScope(DataScopeType.TENANT)
    public OrderDTO getById(Long id) {
        Order order = orderRepository.findById(id)
            .orElseThrow(() -> new OrderNotFoundException("è®¢å•ä¸å­˜åœ¨: " + id));
        return OrderDTO.fromEntity(order);
    }

    @CacheEvict(value = "orders", allEntries = true)
    @Transactional
    public OrderDTO create(CreateOrderRequest request) {
        // å‚æ•°éªŒè¯
        validateCreateRequest(request);

        // æ£€æŸ¥é‡å¤
        if (orderRepository.existsByOrderNo(request.getOrderNo())) {
            throw new BusinessException("è®¢å•å·å·²å­˜åœ¨: " + request.getOrderNo());
        }

        Order order = Order.builder()
            .orderNo(request.getOrderNo())
            .amount(request.getAmount())
            .status(OrderStatus.PENDING)
            .tenantId(TenantContext.getCurrentTenantId())
            .build();

        order = orderRepository.save(order);
        log.info("åˆ›å»ºè®¢å•æˆåŠŸ: {}", order.getId());

        return OrderDTO.fromEntity(order);
    }

    private void validateCreateRequest(CreateOrderRequest request) {
        if (StringUtils.isBlank(request.getOrderNo())) {
            throw new ValidationException("è®¢å•å·ä¸èƒ½ä¸ºç©º");
        }
        if (request.getAmount() == null || request.getAmount().compareTo(BigDecimal.ZERO) <= 0) {
            throw new ValidationException("è®¢å•é‡‘é¢å¿…é¡»å¤§äº0");
        }
    }
}
```

#### âŒ å¸¸è§é”™è¯¯
```java
// é”™è¯¯1: ç¼ºå°‘äº‹åŠ¡ç®¡ç†
@Service
public class OrderService {
    public OrderDTO create(CreateOrderRequest request) {
        // ç¼ºå°‘@Transactionalæ³¨è§£
    }
}

// é”™è¯¯2: ç¼ºå°‘ç¼“å­˜ç®¡ç†
@Service
@Transactional
public class OrderService {
    public OrderDTO create(CreateOrderRequest request) {
        // ç¼ºå°‘@CacheEvictæ³¨è§£
    }
}

// é”™è¯¯3: ç›´æ¥è¿”å›å®ä½“
@Service
@Transactional
public class OrderService {
    public Order create(CreateOrderRequest request) {
        // ç›´æ¥è¿”å›å®ä½“ï¼Œåº”è¯¥è¿”å›DTO
        return orderRepository.save(order);
    }
}

// é”™è¯¯4: è·¨æœåŠ¡è®¿é—®æ•°æ®åº“
@Service
@Transactional
public class OrderService {
    @Autowired
    private UserRepository userRepository; // è·¨æœåŠ¡è®¿é—®
}
```

### Entityå±‚æ£€æŸ¥

#### âœ… æ­£ç¡®å®ç°
```java
@Entity
@Table(name = "orders", indexes = {
    @Index(name = "idx_order_no", columnList = "order_no"),
    @Index(name = "idx_tenant_id", columnList = "tenant_id")
})
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@EqualsAndHashCode(callSuper = true)
public class Order extends BaseEntity {

    @Column(name = "order_no", nullable = false, unique = true, length = 64)
    private String orderNo;

    @Column(name = "amount", nullable = false, precision = 19, scale = 2)
    private BigDecimal amount;

    @Column(name = "status", nullable = false)
    @Enumerated(EnumType.STRING)
    private OrderStatus status;

    @Column(name = "user_id", nullable = false)
    private Long userId;

    @Column(name = "station_id", nullable = false)
    private Long stationId;

    @Column(name = "start_time")
    private LocalDateTime startTime;

    @Column(name = "end_time")
    private LocalDateTime endTime;

    @PrePersist
    protected void onCreate() {
        super.onCreate();
        if (status == null) {
            status = OrderStatus.PENDING;
        }
    }

    @PreUpdate
    protected void onUpdate() {
        super.onUpdate();
        // ä¸šåŠ¡é€»è¾‘éªŒè¯
        if (endTime != null && startTime != null && endTime.isBefore(startTime)) {
            throw new IllegalStateException("ç»“æŸæ—¶é—´ä¸èƒ½æ—©äºå¼€å§‹æ—¶é—´");
        }
    }
}
```

#### âŒ å¸¸è§é”™è¯¯
```java
// é”™è¯¯1: ç¼ºå°‘å®¡è®¡å­—æ®µ
@Entity
@Table(name = "orders")
public class Order {
    @Id
    private Long id;
    // ç¼ºå°‘created_at, updated_atç­‰å®¡è®¡å­—æ®µ
}

// é”™è¯¯2: ç¼ºå°‘ç§Ÿæˆ·å­—æ®µ
@Entity
@Table(name = "orders")
public class Order extends BaseEntity {
    // ç¼ºå°‘tenant_idå­—æ®µ
}

// é”™è¯¯3: ä½¿ç”¨ä¸å½“çš„æ•°æ®ç±»å‹
@Entity
@Table(name = "orders")
public class Order {
    @Column(name = "amount")
    private String amount; // é‡‘é¢åº”è¯¥ä½¿ç”¨BigDecimal
}
```

### æµ‹è¯•ä»£ç æ£€æŸ¥

#### âœ… æ­£ç¡®å®ç°
```java
@ExtendWith(MockitoExtension.class)
@Slf4j
class OrderServiceTest {

    @Mock
    private OrderRepository orderRepository;

    @Mock
    private RedisTemplate<String, Object> redisTemplate;

    @InjectMocks
    private OrderService orderService;

    @Test
    @DisplayName("åº”è¯¥æˆåŠŸåˆ›å»ºè®¢å•")
    void shouldCreateOrderSuccessfully() {
        // Given
        CreateOrderRequest request = CreateOrderRequest.builder()
            .orderNo("ORDER-2024-001")
            .amount(new BigDecimal("100.00"))
            .build();

        Order savedOrder = Order.builder()
            .id(1L)
            .orderNo("ORDER-2024-001")
            .amount(new BigDecimal("100.00"))
            .status(OrderStatus.PENDING)
            .build();

        when(orderRepository.save(any(Order.class))).thenReturn(savedOrder);
        when(orderRepository.existsByOrderNo(anyString())).thenReturn(false);

        // Set tenant context
        TenantContext.setCurrentTenantId(1L);

        // When
        OrderDTO result = orderService.create(request);

        // Then
        assertThat(result.getId()).isEqualTo(1L);
        assertThat(result.getOrderNo()).isEqualTo("ORDER-2024-001");
        assertThat(result.getAmount()).isEqualTo(new BigDecimal("100.00"));
        assertThat(result.getStatus()).isEqualTo(OrderStatus.PENDING);

        verify(orderRepository).save(any(Order.class));
        verify(orderRepository).existsByOrderNo("ORDER-2024-001");

        // Cleanup
        TenantContext.clear();
    }

    @Test
    @DisplayName("è®¢å•å·é‡å¤æ—¶åº”è¯¥æŠ›å‡ºå¼‚å¸¸")
    void shouldThrowExceptionWhenOrderNoExists() {
        // Given
        CreateOrderRequest request = CreateOrderRequest.builder()
            .orderNo("DUPLICATE-ORDER")
            .amount(new BigDecimal("50.00"))
            .build();

        when(orderRepository.existsByOrderNo("DUPLICATE-ORDER")).thenReturn(true);
        TenantContext.setCurrentTenantId(1L);

        // When & Then
        BusinessException exception = assertThrows(BusinessException.class,
            () -> orderService.create(request));

        assertThat(exception.getMessage()).contains("è®¢å•å·å·²å­˜åœ¨");

        TenantContext.clear();
    }
}
```

#### âŒ å¸¸è§é”™è¯¯
```java
// é”™è¯¯1: ç¼ºå°‘æµ‹è¯•åœºæ™¯
@ExtendWith(MockitoExtension.class)
class OrderServiceTest {
    @Test
    void testCreate() {
        // æµ‹è¯•åœºæ™¯ä¸å®Œæ•´ï¼Œç¼ºå°‘è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µ
    }
}

// é”™è¯¯2: ä¸è®¾ç½®æµ‹è¯•ä¸Šä¸‹æ–‡
@ExtendWith(MockitoExtension.class)
class OrderServiceTest {
    @Test
    void shouldCreateOrder() {
        // ç¼ºå°‘TenantContextè®¾ç½®
        orderService.create(request);
    }
}

// é”™è¯¯3: éªŒè¯ä¸å……åˆ†
@ExtendWith(MockitoExtension.class)
class OrderServiceTest {
    @Test
    void shouldCreateOrder() {
        // When
        orderService.create(request);

        // Then - ç¼ºå°‘æ–­è¨€éªŒè¯
    }
}
```

## ğŸ”§ è‡ªåŠ¨åŒ–æ£€æŸ¥å·¥å…·

### Gradleæ£€æŸ¥æ’ä»¶
```gradle
// build.gradle
plugins {
    id 'java'
    id 'org.springframework.boot'
    id 'checkstyle'
    id 'pmd'
    id 'com.github.spotbugs'
}

checkstyle {
    toolVersion = '10.12.4'
    configFile = file("${rootDir}/config/checkstyle/checkstyle.xml")
}

pmd {
    toolVersion = '6.55.0'
    ruleSetFiles = files("${rootDir}/config/pmd/ruleset.xml")
}

spotbugs {
    toolVersion = '4.7.3'
    ignoreFailures = false
}
```

### è´¨é‡é—¨ç¦é…ç½®
```yaml
# .github/workflows/quality-check.yml
name: Code Quality Check

on: [push, pull_request]

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK 21
        uses: actions/setup-java@v3
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Run Checkstyle
        run: ./gradlew checkstyleMain checkstyleTest

      - name: Run PMD
        run: ./gradlew pmdMain pmdTest

      - name: Run SpotBugs
        run: ./gradlew spotbugsMain spotbugsTest

      - name: Run Tests
        run: ./gradlew test

      - name: Generate Test Coverage Report
        run: ./gradlew jacocoTestReport

      - name: Upload Coverage to Codecov
        uses: codecov/codecov-action@v3
```

## ğŸ“Š è´¨é‡æŒ‡æ ‡

### ç›®æ ‡æŒ‡æ ‡
- **ä»£ç è¦†ç›–ç‡**: >= 80%
- **ä»£ç é‡å¤ç‡**: <= 3%
- **åœˆå¤æ‚åº¦**: <= 10
- **æ–¹æ³•é•¿åº¦**: <= 50è¡Œ
- **ç±»é•¿åº¦**: <= 500è¡Œ
- **æŠ€æœ¯å€ºåŠ¡**: <= 1å¤©

### ç›‘æ§æŒ‡æ ‡
- **æ„å»ºæˆåŠŸç‡**: 100%
- **å•å…ƒæµ‹è¯•é€šè¿‡ç‡**: 100%
- **é›†æˆæµ‹è¯•é€šè¿‡ç‡**: 100%
- **ä»£ç è´¨é‡è¯„åˆ†**: >= Açº§

## ğŸš€ æŒç»­æ”¹è¿›

### å®šæœŸå®¡æŸ¥
- **æ¯å‘¨**: ä»£ç è´¨é‡æŒ‡æ ‡å›é¡¾
- **æ¯æœˆ**: æŠ€æœ¯å€ºåŠ¡è¯„ä¼°
- **æ¯å­£åº¦**: è´¨é‡æ ‡å‡†æ›´æ–°

### åŸ¹è®­å’Œåˆ†äº«
- **æ–°å‘˜å·¥**: ä»£ç è´¨é‡åŸ¹è®­
- **å›¢é˜Ÿåˆ†äº«**: è´¨é‡æœ€ä½³å®è·µåˆ†äº«
- **å¤–éƒ¨å­¦ä¹ **: å¼•å…¥æ–°çš„è´¨é‡å·¥å…·å’Œæ–¹æ³•

é€šè¿‡éµå¾ªè¿™ä¸ªæ£€æŸ¥æ¸…å•ï¼Œå¯ä»¥ç¡®ä¿EVCSé¡¹ç›®çš„ä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œæ€§èƒ½è¾¾åˆ°ä¼ä¸šçº§æ ‡å‡†ã€‚
