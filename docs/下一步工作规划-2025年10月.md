# EVCS Manager ä¸‹ä¸€æ­¥å·¥ä½œè§„åˆ’ï¼ˆ2025å¹´10æœˆï¼‰

> **è§„åˆ’æ—¥æœŸ**: 2025-10-11  
> **å½“å‰çŠ¶æ€**: M7å®Œæˆï¼ˆç›‘æ§ä½“ç³»å»ºç«‹ï¼‰  
> **è§„åˆ’å‘¨æœŸ**: å‰©ä½™5å‘¨ï¼ˆç¬¬1ã€2ã€4ã€5ã€6ã€8å‘¨ï¼‰

---

## ä¸€ã€å½“å‰è¿›åº¦æ¦‚è§ˆ ğŸ“Š

### âœ… å·²å®Œæˆé‡Œç¨‹ç¢‘

#### M0-M2: åŸºç¡€æ¶æ„ï¼ˆP0/P1ï¼‰
- âœ… å¤šç§Ÿæˆ·å››å±‚éš”ç¦»æ¶æ„
- âœ… åˆ†æ—¶è®¡è´¹ç³»ç»Ÿï¼ˆTOUï¼‰
- âœ… è®¢å•ç®¡ç†å®Œæ•´é—­ç¯
- âœ… å……ç”µç«™ä¸å……ç”µæ¡©ç®¡ç†
- âœ… PrometheusæŒ‡æ ‡æš´éœ²

#### M3: æ”¯ä»˜é›†æˆ
- âœ… æ”¯ä»˜å®é›†æˆï¼ˆAPP + æ‰«ç ï¼‰
- âœ… å¾®ä¿¡æ”¯ä»˜é›†æˆï¼ˆå°ç¨‹åº + Nativeï¼‰
- âœ… æ”¯ä»˜å¯¹è´¦åŠŸèƒ½
- âœ… é›†æˆæµ‹è¯•å¥—ä»¶

#### M6: è´¨é‡æå‡
- âœ… é›†æˆæµ‹è¯•æ¡†æ¶
- âœ… å¤šç§Ÿæˆ·éš”ç¦»æµ‹è¯•
- âœ… ä»£ç è´¨é‡æ”¹è¿›

#### M7: ç›‘æ§ä½“ç³»ï¼ˆåˆšå®Œæˆï¼ï¼‰
- âœ… JSONæ ¼å¼æ—¥å¿— + æ•æ„Ÿä¿¡æ¯è„±æ•
- âœ… Prometheusä¸šåŠ¡æŒ‡æ ‡æ¡†æ¶
- âœ… Grafana Dashboardï¼ˆç³»ç»Ÿ + ä¸šåŠ¡ï¼‰
- âœ… Resilience4jç†”æ–­é™æµ
- âœ… ELKæ—¥å¿—æ”¶é›†é…ç½®

### â³ å¾…å®Œæˆä»»åŠ¡ï¼ˆP3é˜¶æ®µå‰©ä½™å·¥ä½œï¼‰

#### ç¬¬1å‘¨ï¼šç¯å¢ƒä¿®å¤ä¸å®‰å…¨åŠ å›º ğŸ”´
- å½“å‰Javaç‰ˆæœ¬: **17** âŒ ç›®æ ‡: **21**
- Gradle Wrapper JAR: âœ… å·²å­˜åœ¨
- JWTå®‰å…¨æ¼æ´: âš ï¸ å¾…ä¿®å¤
- ç§Ÿæˆ·ä¸Šä¸‹æ–‡æ¸…ç†: âš ï¸ å¾…å®Œå–„
- å¼‚å¸¸å¤„ç†é¡ºåº: âš ï¸ å¾…ä¿®å¤

#### ç¬¬2å‘¨ï¼šåè®®äº‹ä»¶æµå¯¹æ¥ ğŸŸ 
- åè®®äº‹ä»¶æ¨¡å‹: âœ… åŸºç¡€å®Œæˆï¼ˆProtocolEventåŸºç±»å­˜åœ¨ï¼‰
- RabbitMQé›†æˆ: â³ é…ç½®ç±»å­˜åœ¨ï¼Œéœ€å®Œå–„
- åè®®é€‚é…å™¨: â³ æ¥å£å®šä¹‰å®Œæˆï¼Œéœ€å®ç°
- åè®®è°ƒè¯•å·¥å…·: âœ… ProtocolDebugControllerå·²åˆ›å»º

#### ç¬¬4å‘¨ï¼šæ€§èƒ½ä¼˜åŒ– ğŸŸ¡
- Redisç¼“å­˜: â³ å¾…å®ç°
- å¯¹è´¦ä¼˜åŒ–: â³ å¾…å®ç°åˆ†é¡µ
- æ•°æ®åº“ç´¢å¼•: â³ å¾…ä¼˜åŒ–
- æ€§èƒ½å‹æµ‹: â³ å¾…æ‰§è¡Œ

#### ç¬¬5å‘¨ï¼šå‰ç«¯å¼€å‘ ğŸŸ¢
- å‰ç«¯æ¡†æ¶: âœ… evcs-adminç›®å½•å­˜åœ¨ï¼ˆVue 3ï¼‰
- ç®¡ç†ç•Œé¢: âœ… åŸºç¡€ç»“æ„å®Œæˆ
- åŠŸèƒ½å®Œå–„: â³ å¾…è¡¥å……

#### ç¬¬6å‘¨ï¼šä»£ç è´¨é‡ ğŸŸ¢
- ç§Ÿæˆ·è¿‡æ»¤ä¼˜åŒ–: â³ å¾…æ¸…ç†æ‰‹åŠ¨è¿‡æ»¤
- JSONå¤„ç†ä¼˜åŒ–: â³ å¾…ç”¨Jacksonæ›¿ä»£æ‰‹åŠ¨æ‹¼æ¥
- TODOæ¸…ç†: â³ 9ä¸ªTODOå¾…å®ç°

#### ç¬¬8å‘¨ï¼šæµ‹è¯•å‘å¸ƒ ğŸ”´
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡: ~40% â†’ ç›®æ ‡80%
- é›†æˆæµ‹è¯•: â³ å¾…è¡¥å……
- æ–‡æ¡£å®Œå–„: â³ å¾…æ›´æ–°
- å‘å¸ƒå‡†å¤‡: â³ å¾…è§„åˆ’

---

## äºŒã€ç´§æ€¥ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰

### ğŸ”¥ ç¬¬1å‘¨ï¼šç¯å¢ƒä¿®å¤ä¸å®‰å…¨åŠ å›ºï¼ˆç«‹å³å¼€å§‹ï¼‰

**ä¸ºä»€ä¹ˆæœ€é‡è¦**: 
- Javaç‰ˆæœ¬ä¸åŒ¹é…ä¼šå¯¼è‡´æ„å»ºé—®é¢˜
- å®‰å…¨æ¼æ´å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ï¼ˆé«˜é£é™©ï¼‰
- ç§Ÿæˆ·ä¸Šä¸‹æ–‡æ³„æ¼å¯èƒ½é€ æˆæ•°æ®ä¸²è¯»ï¼ˆä¸¥é‡åæœï¼‰

**æ ¸å¿ƒä»»åŠ¡æ¸…å•**:

#### ä»»åŠ¡1: Javaç‰ˆæœ¬ç»Ÿä¸€åˆ°21 âœ… ä¼˜å…ˆçº§P0
**ç°çŠ¶**: å½“å‰ä½¿ç”¨Java 17ï¼Œé¡¹ç›®é…ç½®è¦æ±‚Java 21  
**å½±å“**: æŸäº›Java 21ç‰¹æ€§æ— æ³•ä½¿ç”¨ï¼Œæ„å»ºç¯å¢ƒä¸ä¸€è‡´

**æ“ä½œæ­¥éª¤**:
1. æ›´æ–°æœ¬åœ°å¼€å‘ç¯å¢ƒåˆ°Java 21
2. æ›´æ–°CI/CDé…ç½®ï¼ˆ`.github/workflows/*.yml`ï¼‰
3. æ›´æ–°DockeråŸºç¡€é•œåƒï¼ˆ`FROM eclipse-temurin:21-jre-jammy`ï¼‰
4. éªŒè¯æ„å»º: `./gradlew clean build`

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ‰€æœ‰ç¯å¢ƒJavaç‰ˆæœ¬ç»Ÿä¸€ä¸º21ï¼Œæ„å»ºé€šè¿‡

---

#### ä»»åŠ¡2: ä¿®å¤JWTç™½åå•è·¯å¾„éå†æ¼æ´ ğŸ”´ ä¼˜å…ˆçº§P0
**ç°çŠ¶**: `JwtAuthGlobalFilter` ä½¿ç”¨ `startsWith()` åŒ¹é…ç™½åå•  
**é£é™©**: æ”»å‡»è€…å¯èƒ½é€šè¿‡ `/auth/login/../admin/users` ç»•è¿‡éªŒè¯

**ä¿®å¤æ–¹æ¡ˆ**:
```java
// æ–‡ä»¶ä½ç½®: evcs-gateway/src/main/java/com/evcs/gateway/filter/JwtAuthGlobalFilter.java

// æ–¹æ³•1: ä½¿ç”¨PathMatcherï¼ˆæ¨èï¼‰
private final PathMatcher pathMatcher = new AntPathMatcher();

private boolean isWhitelisted(String path) {
    // å…ˆè§„èŒƒåŒ–è·¯å¾„ï¼Œé˜²æ­¢ ../ ç»•è¿‡
    String normalizedPath = pathMatcher.combine("/", path);
    
    return WHITE_LIST.stream()
        .anyMatch(pattern -> pathMatcher.match(pattern, normalizedPath));
}

// æ–¹æ³•2: è·¯å¾„è§„èŒƒåŒ– + ç²¾ç¡®åŒ¹é…
private String normalizePath(String path) {
    try {
        return Paths.get(path).normalize().toString();
    } catch (Exception e) {
        return path;
    }
}
```

**æµ‹è¯•ç”¨ä¾‹**:
```java
@Test
void testPathTraversalAttack() {
    // åº”è¯¥è¢«æ‹’ç»
    assertFalse(isWhitelisted("/auth/login/../admin/users"));
    assertFalse(isWhitelisted("/auth/../admin/users"));
    
    // åº”è¯¥è¢«å…è®¸
    assertTrue(isWhitelisted("/auth/login"));
    assertTrue(isWhitelisted("/auth/register"));
}
```

**é¢„è®¡æ—¶é—´**: 3-4å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: è·¯å¾„éå†æ”»å‡»æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

#### ä»»åŠ¡3: ç§Ÿæˆ·ä¸Šä¸‹æ–‡å¼‚å¸¸å¤„ç†å¢å¼º ğŸ”´ ä¼˜å…ˆçº§P0
**ç°çŠ¶**: `TenantContext.getCurrentTenantId()` è¿”å›nullæ—¶è¿”å›-1  
**é—®é¢˜**: -1å¯èƒ½è¢«å½“ä½œæœ‰æ•ˆç§Ÿæˆ·IDï¼Œéš¾ä»¥è¿½è¸ªé—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ**:
```java
// æ–‡ä»¶ä½ç½®: evcs-common/src/main/java/com/evcs/common/context/TenantContext.java

public static Long getCurrentTenantId() {
    Long tenantId = TENANT_ID.get();
    if (tenantId == null) {
        throw new TenantContextMissingException(
            "ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç¼ºå¤±ï¼Œè¯·æ£€æŸ¥è¯·æ±‚æ˜¯å¦æºå¸¦ç§Ÿæˆ·ä¿¡æ¯");
    }
    return tenantId;
}

// æä¾›å¯é€‰çš„è·å–æ–¹æ³•ï¼ˆä¸æŠ›å¼‚å¸¸ï¼‰
public static Optional<Long> getTenantIdOptional() {
    return Optional.ofNullable(TENANT_ID.get());
}
```

**å¼‚å¸¸å¤„ç†å™¨**:
```java
// æ–‡ä»¶ä½ç½®: evcs-common/src/main/java/com/evcs/common/exception/GlobalExceptionHandler.java

@ExceptionHandler(TenantContextMissingException.class)
public ResponseEntity<Result<?>> handleTenantContextMissing(
        TenantContextMissingException e) {
    log.error("ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç¼ºå¤±: {}", e.getMessage());
    return ResponseEntity.status(HttpStatus.FORBIDDEN)
        .body(Result.error(403, "ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç¼ºå¤±ï¼Œè®¿é—®è¢«æ‹’ç»"));
}
```

**é¢„è®¡æ—¶é—´**: 2å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: ç§Ÿæˆ·ä¸Šä¸‹æ–‡ç¼ºå¤±æ—¶æŠ›å‡ºæ˜ç¡®å¼‚å¸¸ï¼Œæ—¥å¿—å¯è¿½è¸ª

---

#### ä»»åŠ¡4: å®Œå–„TenantContextæ¸…ç†æœºåˆ¶ ğŸŸ¡ ä¼˜å…ˆçº§P1
**ç°çŠ¶**: ThreadLocalå¯èƒ½åœ¨çº¿ç¨‹æ± åœºæ™¯æ³„æ¼  
**é£é™©**: ç§Ÿæˆ·æ•°æ®ä¸²è¯»ï¼Œä¸¥é‡å®‰å…¨é—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ**:
```java
// æ–‡ä»¶ä½ç½®: evcs-gateway/src/main/java/com/evcs/gateway/filter/TenantInterceptor.java

@Override
public boolean preHandle(HttpServletRequest request, 
                        HttpServletResponse response, 
                        Object handler) throws Exception {
    try {
        // è®¾ç½®ç§Ÿæˆ·ä¸Šä¸‹æ–‡
        Long tenantId = extractTenantId(request);
        TenantContext.setCurrentTenantId(tenantId);
        return true;
    } catch (Exception e) {
        log.error("ç§Ÿæˆ·ä¸Šä¸‹æ–‡åˆå§‹åŒ–å¤±è´¥", e);
        throw e;
    }
}

@Override
public void afterCompletion(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler, 
                           Exception ex) throws Exception {
    // ç¡®ä¿æ¸…ç†ä¸Šä¸‹æ–‡
    try {
        TenantContext.clear();
    } catch (Exception e) {
        log.error("ç§Ÿæˆ·ä¸Šä¸‹æ–‡æ¸…ç†å¤±è´¥", e);
    }
}
```

**è€ƒè™‘ä½¿ç”¨ TransmittableThreadLocal**:
```java
// æ·»åŠ ä¾èµ–: implementation 'com.alibaba:transmittable-thread-local:2.14.5'

private static final TransmittableThreadLocal<Long> TENANT_ID = 
    new TransmittableThreadLocal<>();
```

**å¹¶å‘æµ‹è¯•**:
```java
@Test
void testConcurrentTenantIsolation() throws Exception {
    int threadCount = 100;
    int requestPerThread = 100;
    
    ExecutorService executor = Executors.newFixedThreadPool(threadCount);
    
    for (int i = 0; i < threadCount; i++) {
        final long tenantId = i;
        executor.submit(() -> {
            for (int j = 0; j < requestPerThread; j++) {
                TenantContext.setCurrentTenantId(tenantId);
                try {
                    assertEquals(tenantId, TenantContext.getCurrentTenantId());
                } finally {
                    TenantContext.clear();
                }
            }
        });
    }
    
    executor.shutdown();
    executor.awaitTermination(1, TimeUnit.MINUTES);
}
```

**é¢„è®¡æ—¶é—´**: 4-5å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: 10000æ¬¡å¹¶å‘è¯·æ±‚æ— ç§Ÿæˆ·æ•°æ®ä¸²è¯»

---

#### ä»»åŠ¡5: ä¿®å¤GlobalExceptionHandleré¡ºåºå†²çª ğŸŸ¡ ä¼˜å…ˆçº§P2
**ç°çŠ¶**: å¤šä¸ª `RuntimeException` å¤„ç†å™¨å¯èƒ½å†²çª  
**é—®é¢˜**: å¼‚å¸¸å¤„ç†ä¸å¯é¢„æµ‹ï¼Œè¿”å›é”™è¯¯çš„HTTPçŠ¶æ€ç 

**ä¿®å¤æ–¹æ¡ˆ**:
```java
// æ–‡ä»¶ä½ç½®: evcs-common/src/main/java/com/evcs/common/exception/GlobalExceptionHandler.java

// ç§»é™¤å†—ä½™çš„é€šç”¨RuntimeExceptionå¤„ç†å™¨
// @ExceptionHandler(RuntimeException.class) <- åˆ é™¤

// ä¿ç•™å…·ä½“çš„å¼‚å¸¸å¤„ç†å™¨
@ExceptionHandler(TenantContextMissingException.class)
@Order(1)
public ResponseEntity<?> handleTenantContextMissing(...) { ... }

@ExceptionHandler(BusinessException.class)
@Order(2)
public ResponseEntity<?> handleBusinessException(...) { ... }

@ExceptionHandler(MethodArgumentNotValidException.class)
@Order(3)
public ResponseEntity<?> handleValidationException(...) { ... }

// æœ€åæ‰æ˜¯é€šç”¨Exceptionå¤„ç†å™¨
@ExceptionHandler(Exception.class)
@Order(100)
public ResponseEntity<?> handleException(...) { ... }
```

**é¢„è®¡æ—¶é—´**: 2å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: ä¸åŒå¼‚å¸¸è¿”å›æ­£ç¡®çš„HTTPçŠ¶æ€ç 

---

**ç¬¬1å‘¨æ€»ç»“**:
- æ€»å·¥ä½œé‡: çº¦14å°æ—¶
- éªŒæ”¶æ ‡å‡†: 
  - âœ… æ„å»ºåœ¨å¹²å‡€ç¯å¢ƒé€šè¿‡
  - âœ… å®‰å…¨æ‰«ææ— é«˜å±æ¼æ´
  - âœ… å¹¶å‘æµ‹è¯•é€šè¿‡
  - âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡

---

### ğŸŸ  ç¬¬2å‘¨ï¼šåè®®äº‹ä»¶æµå¯¹æ¥ï¼ˆç¬¬1å‘¨å®Œæˆåï¼‰

**ä¸ºä»€ä¹ˆé‡è¦**: 
- å……ç”µæ¡©å®æ—¶é€šä¿¡çš„æ ¸å¿ƒåŠŸèƒ½
- å½±å“è®¢å•åˆ›å»ºå’ŒçŠ¶æ€æ›´æ–°
- RabbitMQæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç³»ç»Ÿè§£è€¦çš„å…³é”®

**æ ¸å¿ƒä»»åŠ¡æ¸…å•**:

#### ä»»åŠ¡1: å®Œå–„åè®®äº‹ä»¶æ¨¡å‹ ğŸ“‹ ä¼˜å…ˆçº§P1
**ç°çŠ¶**: `ProtocolEvent` åŸºç±»å·²å­˜åœ¨ï¼Œä½†å…·ä½“äº‹ä»¶ç±»éœ€è¦å®Œå–„

**å®ç°è®¡åˆ’**:
```java
// å·²å­˜åœ¨: evcs-protocol/src/main/java/com/evcs/protocol/event/ProtocolEvent.java

// éœ€è¦å®Œå–„çš„äº‹ä»¶ç±»:
1. HeartbeatEvent - å¿ƒè·³äº‹ä»¶ âœ…
2. StatusChangeEvent - çŠ¶æ€å˜æ›´äº‹ä»¶ âœ…
3. ChargingStartEvent - å¼€å§‹å……ç”µäº‹ä»¶ âœ…
4. ChargingStopEvent - åœæ­¢å……ç”µäº‹ä»¶ âœ…
5. ErrorEvent - é”™è¯¯äº‹ä»¶ â³
```

**äº‹ä»¶è·¯ç”±é”®è®¾è®¡**:
```java
public String getRoutingKey() {
    return String.format("evcs.protocol.%s.%s", 
        protocolType.toLowerCase(),    // ocpp / cloudcharge
        eventType.toString().toLowerCase());  // heartbeat / status / start / stop
}

// ç¤ºä¾‹:
// evcs.protocol.ocpp.heartbeat
// evcs.protocol.cloudcharge.status
// evcs.protocol.ocpp.start
```

**é¢„è®¡æ—¶é—´**: 4å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ‰€æœ‰äº‹ä»¶ç±»å‹å®šä¹‰å®Œæ•´ï¼Œè·¯ç”±é”®è®¾è®¡åˆç†

---

#### ä»»åŠ¡2: RabbitMQæ¶ˆæ¯é˜Ÿåˆ—é›†æˆ ğŸ“¬ ä¼˜å…ˆçº§P1
**ç°çŠ¶**: `RabbitMQConfig` å’Œ `ProtocolEventPublisher` å·²å­˜åœ¨

**é…ç½®å®Œå–„**:
```yaml
# application.yml
spring:
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:admin}
    password: ${RABBITMQ_PASSWORD:admin123}
    virtual-host: /evcs
    
    # å‘å¸ƒè€…ç¡®è®¤
    publisher-confirm-type: correlated
    publisher-returns: true
    
    # æ¶ˆè´¹è€…é…ç½®
    listener:
      simple:
        acknowledge-mode: manual  # æ‰‹åŠ¨ç¡®è®¤
        prefetch: 10  # é¢„å–æ•°é‡
        retry:
          enabled: true
          max-attempts: 3
```

**Queueç»‘å®šå…³ç³»**:
```java
// Exchange: evcs.protocol.events (Topicç±»å‹)
// â”œâ”€ Queue: evcs.protocol.heartbeat
// â”‚  â””â”€ Binding: evcs.protocol.*.heartbeat
// â”œâ”€ Queue: evcs.protocol.charging
// â”‚  â””â”€ Binding: evcs.protocol.*.start
// â”‚  â””â”€ Binding: evcs.protocol.*.stop
// â”œâ”€ Queue: evcs.protocol.status
// â”‚  â””â”€ Binding: evcs.protocol.*.status
// â””â”€ Queue: evcs.protocol.error
//    â””â”€ Binding: evcs.protocol.*.error
```

**æ­»ä¿¡é˜Ÿåˆ—é…ç½®**:
```java
@Bean
public Queue deadLetterQueue() {
    return QueueBuilder.durable("evcs.protocol.dlq")
        .withArgument("x-message-ttl", 86400000)  // 24å°æ—¶
        .build();
}
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ¶ˆæ¯å‘é€æˆåŠŸç‡100%ï¼Œæ‰‹åŠ¨ackæœºåˆ¶æ­£å¸¸

---

#### ä»»åŠ¡3: åè®®é€‚é…å™¨å®ç° ğŸ”Œ ä¼˜å…ˆçº§P1
**ç°çŠ¶**: `IOCPPProtocolService` å’Œ `ICloudChargeProtocolService` æ¥å£å·²å®šä¹‰

**OCPPåè®®é€‚é…å™¨**:
```java
// å®ç°: evcs-protocol/src/main/java/com/evcs/protocol/service/OCPPProtocolServiceImpl.java

@Service
public class OCPPProtocolServiceImpl implements IOCPPProtocolService {
    
    private final ProtocolEventPublisher eventPublisher;
    
    @Override
    public void handleHeartbeat(Long chargerId, LocalDateTime heartbeatTime) {
        // è§£æOCPPå¿ƒè·³æŠ¥æ–‡
        // è½¬æ¢ä¸ºHeartbeatEvent
        // å‘å¸ƒåˆ°RabbitMQ
        eventPublisher.publishHeartbeat(chargerId, tenantId, "OCPP", heartbeatTime);
    }
    
    @Override
    public void handleStatusNotification(Long chargerId, String status) {
        // è§£æOCPPçŠ¶æ€é€šçŸ¥
        // è½¬æ¢ä¸ºStatusChangeEvent
        eventPublisher.publishStatusChange(chargerId, tenantId, "OCPP", oldStatus, newStatus, statusDesc);
    }
    
    // å®ç°å…¶ä»–æ–¹æ³•...
}
```

**äº‘å¿«å……åè®®é€‚é…å™¨**:
```java
// å®ç°: evcs-protocol/src/main/java/com/evcs/protocol/service/CloudChargeProtocolServiceImpl.java

@Service
public class CloudChargeProtocolServiceImpl implements ICloudChargeProtocolService {
    // ç±»ä¼¼OCPPå®ç°ï¼Œä½†å¤„ç†äº‘å¿«å……åè®®æ ¼å¼
}
```

**é¢„è®¡æ—¶é—´**: 8å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: ä¸¤ç§åè®®éƒ½èƒ½æ­£å¸¸æ¥æ”¶å’Œè½¬æ¢äº‹ä»¶

---

#### ä»»åŠ¡4: æ¶ˆæ¯æ¶ˆè´¹è€…å®ç° ğŸ“¥ ä¼˜å…ˆçº§P1
**å®ç°ä½ç½®**: å„ä¸šåŠ¡æœåŠ¡ä¸­

**è®¢å•æœåŠ¡æ¶ˆè´¹è€…**:
```java
// evcs-order/src/main/java/com/evcs/order/listener/ChargingEventListener.java

@Component
@RabbitListener(queues = "evcs.protocol.charging")
public class ChargingEventListener {
    
    private final OrderService orderService;
    
    @RabbitHandler
    public void handleChargingStart(ChargingStartEvent event, 
                                    Channel channel, 
                                    Message message) {
        try {
            // å¹‚ç­‰æ€§æ£€æŸ¥
            if (orderService.existsBySessionId(event.getSessionId())) {
                channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);
                return;
            }
            
            // åˆ›å»ºè®¢å•
            orderService.createOrderByProtocolEvent(event);
            
            // æ‰‹åŠ¨ç¡®è®¤
            channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);
            
        } catch (Exception e) {
            log.error("å¤„ç†å……ç”µå¼€å§‹äº‹ä»¶å¤±è´¥", e);
            // é‡æ–°å…¥é˜Ÿï¼ˆæœ€å¤š3æ¬¡ï¼‰
            channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, true);
        }
    }
}
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸç‡â‰¥99%ï¼Œå¹‚ç­‰æ€§ä¿è¯

---

#### ä»»åŠ¡5: åè®®è°ƒè¯•å·¥å…·å®Œå–„ ğŸ”§ ä¼˜å…ˆçº§P2
**ç°çŠ¶**: `ProtocolDebugController` å·²å­˜åœ¨

**å¢å¼ºåŠŸèƒ½**:
```java
// evcs-protocol/src/main/java/com/evcs/protocol/controller/ProtocolDebugController.java

@RestController
@RequestMapping("/debug/protocol")
public class ProtocolDebugController {
    
    // æ–°å¢ï¼šæ¨¡æ‹Ÿåè®®äº‹ä»¶
    @PostMapping("/simulate")
    public Result<?> simulateEvent(@RequestBody SimulateEventRequest request) {
        // æ¨¡æ‹Ÿå‘é€OCPPæˆ–äº‘å¿«å……äº‹ä»¶
        // ç”¨äºæµ‹è¯•äº‹ä»¶æµè½¬
    }
    
    // æ–°å¢ï¼šæŸ¥çœ‹äº‹ä»¶å†å²
    @GetMapping("/events/history")
    public Result<?> getEventHistory(
            @RequestParam Long chargerId,
            @RequestParam(required = false) String eventType,
            @RequestParam(defaultValue = "1") int page,
            @RequestParam(defaultValue = "20") int size) {
        // æŸ¥è¯¢RabbitMQæˆ–æ•°æ®åº“ä¸­çš„äº‹ä»¶è®°å½•
    }
    
    // æ–°å¢ï¼šå®æ—¶äº‹ä»¶ç›‘æ§ï¼ˆWebSocketï¼‰
    @MessageMapping("/protocol/subscribe")
    public void subscribeEvents(Long chargerId) {
        // WebSocketæ¨é€å®æ—¶äº‹ä»¶
    }
}
```

**é¢„è®¡æ—¶é—´**: 4å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: åè®®è°ƒè¯•ç•Œé¢å¯ç”¨ï¼Œæ–¹ä¾¿è”è°ƒ

---

#### ä»»åŠ¡6: å‹åŠ›æµ‹è¯• âš¡ ä¼˜å…ˆçº§P1
**ç›®æ ‡**: 1000 TPS

**JMeterè„šæœ¬**:
```xml
<!-- protocol-stress-test.jmx -->
<ThreadGroup>
    <numThreads>100</numThreads>
    <rampUp>10</rampUp>
    <loops>-1</loops>  <!-- æŒç»­å‹æµ‹ -->
    
    <HTTPSampler>
        <path>/protocol/ocpp/heartbeat</path>
        <method>POST</method>
    </HTTPSampler>
</ThreadGroup>
```

**ç›‘æ§æŒ‡æ ‡**:
- RabbitMQæ¶ˆæ¯å †ç§¯é‡
- æ¶ˆè´¹è€…å¤„ç†é€Ÿåº¦
- æ•°æ®åº“å†™å…¥QPS
- æœåŠ¡CPU/å†…å­˜ä½¿ç”¨ç‡

**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: 1000 TPSå‹æµ‹é€šè¿‡ï¼Œæ— æ¶ˆæ¯ä¸¢å¤±

---

**ç¬¬2å‘¨æ€»ç»“**:
- æ€»å·¥ä½œé‡: çº¦34å°æ—¶
- éªŒæ”¶æ ‡å‡†:
  - âœ… åè®®äº‹ä»¶ç«¯åˆ°ç«¯æµè½¬
  - âœ… æ— æ¶ˆæ¯ä¸¢å¤±
  - âœ… å‹æµ‹è¾¾åˆ°1000 TPS
  - âœ… åè®®å¯¹æ¥æ–‡æ¡£å®Œæˆ

---

### ğŸŸ¡ ç¬¬4å‘¨ï¼šåˆ†å¸ƒå¼ç¼“å­˜ä¸æ€§èƒ½ä¼˜åŒ–

**ä¸ºä»€ä¹ˆé‡è¦**:
- è®¡è´¹è®¡åˆ’é¢‘ç¹æŸ¥è¯¢ï¼Œéœ€è¦ç¼“å­˜
- å¤šå®ä¾‹éƒ¨ç½²éœ€è¦ç¼“å­˜ä¸€è‡´æ€§
- å¯¹è´¦æœåŠ¡å¤„ç†å¤§é‡æ•°æ®ï¼Œéœ€è¦ä¼˜åŒ–

**æ ¸å¿ƒä»»åŠ¡æ¸…å•**:

#### ä»»åŠ¡1: Redisåˆ†å¸ƒå¼ç¼“å­˜ ğŸš€ ä¼˜å…ˆçº§P1
**ç¼“å­˜é”®è®¾è®¡**:
```java
// è®¡è´¹è®¡åˆ’ç¼“å­˜
billing:plan:{stationId}:{planId}  // ç‰¹å®šè®¡è´¹è®¡åˆ’
billing:plan:default:{stationId}   // é»˜è®¤è®¡è´¹è®¡åˆ’
```

**ç¼“å­˜æœåŠ¡å®ç°**:
```java
@Service
public class BillingPlanCacheService {
    
    private final RedisTemplate<String, BillingPlan> redisTemplate;
    private final BillingPlanService billingPlanService;
    
    public BillingPlan getByStationAndId(Long stationId, Long planId) {
        String key = String.format("billing:plan:%d:%d", stationId, planId);
        
        // å°è¯•ä»ç¼“å­˜è·å–
        BillingPlan plan = redisTemplate.opsForValue().get(key);
        if (plan != null) {
            return plan;
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“åŠ è½½
        plan = billingPlanService.getById(planId);
        if (plan != null && plan.getStationId().equals(stationId)) {
            // å†™å…¥ç¼“å­˜ï¼ŒTTL=1å°æ—¶
            redisTemplate.opsForValue().set(key, plan, 1, TimeUnit.HOURS);
        }
        
        return plan;
    }
}
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: ç¼“å­˜å‘½ä¸­ç‡â‰¥80%

---

#### ä»»åŠ¡2: Redis Pub/Subå¹¿æ’­ ğŸ“¡ ä¼˜å…ˆçº§P1
**åœºæ™¯**: ç®¡ç†å‘˜ä¿®æ”¹è®¡è´¹è®¡åˆ’ï¼Œéœ€è¦é€šçŸ¥æ‰€æœ‰å®ä¾‹æ¸…ç†ç¼“å­˜

**å¹¿æ’­å®ç°**:
```java
// å‘å¸ƒè€…ï¼ˆè®¡è´¹è®¡åˆ’æ›´æ–°æ—¶ï¼‰
@Service
public class BillingPlanService {
    
    private final RedisTemplate<String, String> redisTemplate;
    
    public void updatePlan(BillingPlan plan) {
        // æ›´æ–°æ•°æ®åº“
        billingPlanMapper.updateById(plan);
        
        // å‘å¸ƒå¹¿æ’­æ¶ˆæ¯
        String message = String.format("billing:plan:update:%d:%d", 
            plan.getStationId(), plan.getId());
        redisTemplate.convertAndSend("billing:plan:update", message);
    }
}

// è®¢é˜…è€…ï¼ˆå„å®ä¾‹ç›‘å¬ï¼‰
@Component
public class BillingPlanCacheInvalidator implements MessageListener {
    
    private final RedisTemplate<String, BillingPlan> redisTemplate;
    
    @Override
    public void onMessage(Message message, byte[] pattern) {
        String msg = new String(message.getBody());
        // è§£ææ¶ˆæ¯: billing:plan:update:stationId:planId
        String[] parts = msg.split(":");
        Long stationId = Long.parseLong(parts[3]);
        Long planId = Long.parseLong(parts[4]);
        
        // æ¸…ç†æœ¬åœ°ç¼“å­˜
        String key = String.format("billing:plan:%d:%d", stationId, planId);
        redisTemplate.delete(key);
    }
}
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: å¤šå®ä¾‹ç¼“å­˜ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡

---

#### ä»»åŠ¡3: å¯¹è´¦æœåŠ¡ä¼˜åŒ– ğŸ”§ ä¼˜å…ˆçº§P1
**ç°çŠ¶**: `ReconciliationService.runDaily()` ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰è®¢å•ï¼Œå¯èƒ½OOM

**åˆ†é¡µä¼˜åŒ–**:
```java
@Service
public class ReconciliationServiceImpl {
    
    public ReconcileResult runDaily(LocalDate date) {
        int pageSize = 1000;
        int pageNum = 1;
        int totalProcessed = 0;
        
        while (true) {
            // åˆ†é¡µæŸ¥è¯¢è®¢å•
            Page<ChargingOrder> page = orderMapper.selectPage(
                new Page<>(pageNum, pageSize),
                new QueryWrapper<ChargingOrder>()
                    .between("start_time", date.atStartOfDay(), date.atTime(23, 59, 59))
                    .eq("status", OrderStatus.COMPLETED.getValue())
            );
            
            if (page.getRecords().isEmpty()) {
                break;
            }
            
            // æ‰¹é‡å¤„ç†
            page.getRecords().forEach(order -> {
                reconcileOrder(order);
            });
            
            totalProcessed += page.getRecords().size();
            pageNum++;
            
            log.info("å¯¹è´¦è¿›åº¦: {}/{}", totalProcessed, page.getTotal());
        }
        
        return ReconcileResult.builder()
            .date(date)
            .totalCount(totalProcessed)
            .build();
    }
}
```

**é¢„è®¡æ—¶é—´**: 4å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: å¤„ç†100ä¸‡è®¢å•æ— OOM

---

#### ä»»åŠ¡4: æ•°æ®åº“ä¼˜åŒ– ğŸ—„ï¸ ä¼˜å…ˆçº§P1
**æ…¢æŸ¥è¯¢åˆ†æ**:
```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
ALTER SYSTEM SET log_min_duration_statement = 500;

-- æŸ¥çœ‹TOP 10æ…¢æŸ¥è¯¢
SELECT query, calls, total_time, mean_time
FROM pg_stat_statements
ORDER BY mean_time DESC
LIMIT 10;
```

**æ·»åŠ ç´¢å¼•**:
```sql
-- è®¢å•è¡¨ç´¢å¼•
CREATE INDEX idx_tenant_start_time 
ON charging_order(tenant_id, start_time);

CREATE INDEX idx_charger_status 
ON charging_order(charger_id, status);

-- å……ç”µæ¡©è¡¨ç´¢å¼•
CREATE INDEX idx_station_status 
ON charger(station_id, status);

-- è®¡è´¹è®¡åˆ’è¡¨ç´¢å¼•
CREATE INDEX idx_station_valid 
ON billing_plan(station_id, valid_from, valid_to);
```

**é¢„è®¡æ—¶é—´**: 6å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ…¢æŸ¥è¯¢å‡å°‘80%

---

#### ä»»åŠ¡5: æ€§èƒ½å‹æµ‹ ğŸ¯ ä¼˜å…ˆçº§P1
**å‹æµ‹ç›®æ ‡**:
- è®¢å•åˆ›å»º: 500 TPS
- è®¢å•æŸ¥è¯¢: 1000 TPS
- å……ç”µæ¡©çŠ¶æ€æ›´æ–°: 2000 TPS

**JMeteråœºæ™¯**:
```xml
<ThreadGroup name="è®¢å•åˆ›å»º">
    <numThreads>50</numThreads>
    <rampUp>10</rampUp>
    <HTTPSampler path="/api/order/start"/>
</ThreadGroup>

<ThreadGroup name="è®¢å•æŸ¥è¯¢">
    <numThreads>100</numThreads>
    <rampUp>10</rampUp>
    <HTTPSampler path="/api/order/list"/>
</ThreadGroup>
```

**ç›‘æ§æŒ‡æ ‡**:
- P50/P95/P99å“åº”æ—¶é—´
- é”™è¯¯ç‡
- CPU/å†…å­˜ä½¿ç”¨ç‡
- æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡

**é¢„è®¡æ—¶é—´**: 8å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ‰€æœ‰æŒ‡æ ‡è¾¾æ ‡

---

**ç¬¬4å‘¨æ€»ç»“**:
- æ€»å·¥ä½œé‡: çº¦30å°æ—¶
- éªŒæ”¶æ ‡å‡†:
  - âœ… ç¼“å­˜ä¸€è‡´æ€§æµ‹è¯•é€šè¿‡
  - âœ… å¯¹è´¦å¤„ç†ç™¾ä¸‡çº§æ•°æ®æ— OOM
  - âœ… æ…¢æŸ¥è¯¢å‡å°‘80%
  - âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

---

### ğŸŸ¢ ç¬¬5å‘¨ï¼šå‰ç«¯ç®¡ç†ç•Œé¢å¼€å‘

**ä¸ºä»€ä¹ˆé‡è¦**:
- æä¾›å¯è§†åŒ–ç®¡ç†ç•Œé¢
- æå‡è¿è¥æ•ˆç‡
- å®Œå–„ç”¨æˆ·ä½“éªŒ

**æ ¸å¿ƒä»»åŠ¡æ¸…å•**:

#### ä»»åŠ¡1: å‰ç«¯åŠŸèƒ½å®Œå–„ ğŸ¨ ä¼˜å…ˆçº§P2
**ç°çŠ¶**: evcs-adminåŸºç¡€ç»“æ„å·²å®Œæˆï¼ˆVue 3 + Vite + Element Plusï¼‰

**éœ€è¦å®Œå–„çš„åŠŸèƒ½**:
1. **ç§Ÿæˆ·ç®¡ç†ç•Œé¢**
   - ç§Ÿæˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ï¼‰
   - ç§Ÿæˆ·æ ‘å½¢ç»“æ„å±•ç¤º
   - ç§Ÿæˆ·æ–°å¢/ç¼–è¾‘è¡¨å•
   - ç§Ÿæˆ·è¯¦æƒ…é¡µ

2. **å……ç”µç«™ç®¡ç†ç•Œé¢**
   - å……ç”µç«™åˆ—è¡¨ï¼ˆå¡ç‰‡/åˆ—è¡¨è§†å›¾åˆ‡æ¢ï¼‰
   - åœ°å›¾å±•ç¤ºï¼ˆé«˜å¾·åœ°å›¾é›†æˆï¼‰
   - å……ç”µç«™è¯¦æƒ…é¡µ
   - å……ç”µæ¡©å®æ—¶çŠ¶æ€ç›‘æ§

3. **è®¢å•ç®¡ç†ç•Œé¢**
   - è®¢å•åˆ—è¡¨ï¼ˆé«˜çº§æœç´¢ï¼‰
   - è®¢å•è¯¦æƒ…é¡µï¼ˆå……ç”µæ—¶é—´è½´ï¼‰
   - è®¢å•ç»Ÿè®¡Dashboard
   - å¯¼å‡ºExcelåŠŸèƒ½

4. **è®¡è´¹é…ç½®ç•Œé¢**
   - è®¡è´¹è®¡åˆ’åˆ—è¡¨
   - åˆ†æ®µå¯è§†åŒ–ç¼–è¾‘å™¨
   - 24å°æ—¶æ—¶é—´è½´é¢„è§ˆ

**é¢„è®¡æ—¶é—´**: 20å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼Œå“åº”å¼è®¾è®¡è‰¯å¥½

---

### ğŸŸ¢ ç¬¬6å‘¨ï¼šä»£ç è´¨é‡æå‡

**ä¸ºä»€ä¹ˆé‡è¦**:
- æå‡ä»£ç å¯ç»´æŠ¤æ€§
- å‡å°‘æŠ€æœ¯å€ºåŠ¡
- ç»Ÿä¸€ä»£ç é£æ ¼

**æ ¸å¿ƒä»»åŠ¡æ¸…å•**:

#### ä»»åŠ¡1: ç§»é™¤æ‰‹åŠ¨ç§Ÿæˆ·è¿‡æ»¤ ğŸ§¹ ä¼˜å…ˆçº§P2
**é—®é¢˜**: éƒ¨åˆ†ä»£ç æ‰‹åŠ¨æ·»åŠ  `WHERE tenant_id = ?`ï¼Œä¸MyBatis Plusè‡ªåŠ¨è¿‡æ»¤å†²çª

**æ¸…ç†èŒƒå›´**:
```java
// æŸ¥æ‰¾æ‰€æœ‰æ‰‹åŠ¨è¿‡æ»¤çš„ä»£ç 
// evcs-order/src/**/*.java
// evcs-station/src/**/*.java
// evcs-tenant/src/**/*.java

// åˆ é™¤ç±»ä¼¼ä»£ç :
wrapper.eq("tenant_id", TenantContext.getCurrentTenantId())
```

**é¢„è®¡æ—¶é—´**: 4å°æ—¶

---

#### ä»»åŠ¡2: JSONå¤„ç†ä¼˜åŒ– ğŸ“ ä¼˜å…ˆçº§P2
**é—®é¢˜**: æ‰‹åŠ¨æ‹¼æ¥JSONå­—ç¬¦ä¸²ï¼Œå¯èƒ½å¯¼è‡´æ ¼å¼é”™è¯¯

**ä¿®å¤æ–¹æ¡ˆ**:
```java
// æ›¿æ¢å‰:
String body = "{\"code\":401,\"message\":\"" + message + "\"}";

// æ›¿æ¢å:
Result<?> result = Result.error(401, message);
String body = objectMapper.writeValueAsString(result);
```

**é¢„è®¡æ—¶é—´**: 4å°æ—¶

---

#### ä»»åŠ¡3: TODOæ¸…ç† âœ… ä¼˜å…ˆçº§P2
**9ä¸ªTODOé¡¹**:
1. `UserServiceImpl.refreshToken()` - Tokenåˆ·æ–°
2. `AuthController.getCurrentUser()` - è·å–å½“å‰ç”¨æˆ·
3. å……ç”µæ¡©äº‹ä»¶æœºåˆ¶ - ä½¿ç”¨Spring Event
4. DataScopeæƒé™æ£€æŸ¥ - åŸºäºè§’è‰²
5. ç§Ÿæˆ·ç±»å‹å’Œç¥–çº§è·¯å¾„æŸ¥è¯¢
6. ç§Ÿæˆ·ä¸šåŠ¡æ•°æ®æ£€æŸ¥
7. ç«™ç‚¹æ£€æŸ¥é€»è¾‘
8. RequestId Filter
9. å…¶ä»–é›¶æ•£TODO

**é¢„è®¡æ—¶é—´**: 12å°æ—¶  
**éªŒæ”¶æ ‡å‡†**: æ‰€æœ‰TODOæ¸…ç†å®Œæˆ

---

**ç¬¬6å‘¨æ€»ç»“**:
- æ€»å·¥ä½œé‡: çº¦20å°æ—¶
- éªŒæ”¶æ ‡å‡†:
  - âœ… æ— æ‰‹åŠ¨tenant_idè¿‡æ»¤
  - âœ… SonarQubeä»£ç è´¨é‡Açº§
  - âœ… æ‰€æœ‰TODOæ¸…ç†å®Œæˆ

---

### ğŸ”´ ç¬¬8å‘¨ï¼šæµ‹è¯•ä¸å‘å¸ƒå‡†å¤‡

**ä¸ºä»€ä¹ˆæœ€é‡è¦**:
- ç¡®ä¿è´¨é‡
- å‡†å¤‡ç”Ÿäº§å‘å¸ƒ
- é¡¹ç›®äº¤ä»˜

**æ ¸å¿ƒä»»åŠ¡æ¸…å•**:

#### ä»»åŠ¡1: å•å…ƒæµ‹è¯•è¡¥å…… ğŸ§ª ä¼˜å…ˆçº§P1
**ç›®æ ‡**: è¦†ç›–ç‡ä»~40%æå‡åˆ°â‰¥80%

**é‡ç‚¹æµ‹è¯•**:
- Serviceå±‚ä¸šåŠ¡é€»è¾‘
- Controllerå±‚å‚æ•°éªŒè¯
- Utilå·¥å…·ç±»è¾¹ç•Œæ¡ä»¶
- å¤šç§Ÿæˆ·éš”ç¦»æµ‹è¯•

**é¢„è®¡æ—¶é—´**: 16å°æ—¶

---

#### ä»»åŠ¡2: é›†æˆæµ‹è¯• ğŸ”— ä¼˜å…ˆçº§P1
**ç«¯åˆ°ç«¯åœºæ™¯**:
1. å®Œæ•´å……ç”µæµç¨‹ï¼ˆå¼€å§‹â†’å……ç”µâ†’ç»“æŸâ†’æ”¯ä»˜â†’å¯¹è´¦ï¼‰
2. æ”¯ä»˜æµç¨‹ï¼ˆä¸‹å•â†’æ”¯ä»˜â†’å›è°ƒâ†’å®Œæˆï¼‰
3. å¤šç§Ÿæˆ·éš”ç¦»ï¼ˆç§Ÿæˆ·Aæ•°æ®å¯¹ç§Ÿæˆ·Bä¸å¯è§ï¼‰

**é¢„è®¡æ—¶é—´**: 8å°æ—¶

---

#### ä»»åŠ¡3: æ–‡æ¡£å®Œå–„ ğŸ“š ä¼˜å…ˆçº§P1
**éœ€è¦æ›´æ–°çš„æ–‡æ¡£**:
1. APIæ–‡æ¡£ï¼ˆSwaggerå¯¼å‡ºï¼‰
2. éƒ¨ç½²è¿ç»´æ‰‹å†Œï¼ˆDocker + K8sï¼‰
3. å¼€å‘è€…æŒ‡å—ï¼ˆæ–°æ¨¡å—å¼€å‘ã€ä»£ç è§„èŒƒï¼‰
4. æ•…éšœæ’æŸ¥æ‰‹å†Œï¼ˆå¸¸è§é—®é¢˜FAQï¼‰

**é¢„è®¡æ—¶é—´**: 8å°æ—¶

---

#### ä»»åŠ¡4: å‘å¸ƒå‡†å¤‡ ğŸš€ ä¼˜å…ˆçº§P1
**æ¸…å•æ£€æŸ¥**:
- âœ… ä»£ç å®¡æŸ¥å®Œæˆ
- âœ… æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- âœ… æ–‡æ¡£æ›´æ–°å®Œæˆ
- âœ… æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- âœ… å®‰å…¨æ‰«æé€šè¿‡

**ç°åº¦å‘å¸ƒè®¡åˆ’**:
- Day 1: 5%æµé‡
- Day 2: 20%æµé‡
- Day 3: 50%æµé‡
- Day 4: 100%å…¨é‡

**é¢„è®¡æ—¶é—´**: 8å°æ—¶

---

**ç¬¬8å‘¨æ€»ç»“**:
- æ€»å·¥ä½œé‡: çº¦40å°æ—¶
- éªŒæ”¶æ ‡å‡†:
  - âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡â‰¥80%
  - âœ… é›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
  - âœ… æ–‡æ¡£é½å…¨
  - âœ… å‘å¸ƒæ¸…å•å®Œæˆ

---

## ä¸‰ã€å…³é”®é£é™©ä¸åº”å¯¹ç­–ç•¥ âš ï¸

### é£é™©1: æ—¶é—´ä¸è¶³
**æ¦‚ç‡**: ä¸­  
**å½±å“**: é«˜  
**åº”å¯¹**: 
- ä¼˜å…ˆå®ŒæˆP0/P1ä»»åŠ¡
- P2ä»»åŠ¡å¯å»¶æœŸåˆ°ä¸‹ä¸€é˜¶æ®µ
- ç¬¬8å‘¨å¯å»¶é•¿1å‘¨ä½œä¸ºç¼“å†²

### é£é™©2: åè®®è®¾å¤‡ä¸å¯ç”¨
**æ¦‚ç‡**: ä¸­  
**å½±å“**: é«˜  
**åº”å¯¹**: 
- æå‰å‡†å¤‡OCPPæ¨¡æ‹Ÿå™¨
- è”ç³»äº‘å¿«å……å‚å•†è·å–æ²™ç®±
- ä½¿ç”¨åè®®è°ƒè¯•å·¥å…·æ¨¡æ‹Ÿ

### é£é™©3: æ€§èƒ½ç›®æ ‡æœªè¾¾æ ‡
**æ¦‚ç‡**: ä½  
**å½±å“**: é«˜  
**åº”å¯¹**: 
- ç¬¬4å‘¨æå‰å‹æµ‹
- é¢„ç•™ä¼˜åŒ–æ—¶é—´
- å¿…è¦æ—¶é™ä½éƒ¨åˆ†æŒ‡æ ‡

### é£é™©4: å¤šç§Ÿæˆ·æ•°æ®æ³„æ¼
**æ¦‚ç‡**: ä½  
**å½±å“**: æé«˜  
**åº”å¯¹**: 
- ä¸“é¡¹å®‰å…¨æµ‹è¯•
- ä»£ç å®¡æŸ¥é‡ç‚¹å…³æ³¨
- å¢åŠ å¹¶å‘æµ‹è¯•åœºæ™¯

---

## å››ã€æˆåŠŸæ ‡å‡† ğŸ¯

### åŠŸèƒ½å®Œæ•´æ€§
- âœ… P0çº§åˆ«é—®é¢˜100%ä¿®å¤
- âœ… P1çº§åˆ«åŠŸèƒ½100%å®Œæˆ
- âœ… P2çº§åˆ«åŠŸèƒ½80%+å®Œæˆ

### æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|---------|
| è®¢å•åˆ›å»ºæ¥å£ | 500 TPS | JMeterå‹æµ‹ |
| è®¢å•æŸ¥è¯¢æ¥å£ | 1000 TPS | JMeterå‹æµ‹ |
| å……ç”µæ¡©çŠ¶æ€æ›´æ–° | 2000 TPS | JMeterå‹æµ‹ |
| æ¥å£P99å»¶è¿Ÿ | < 200ms | Prometheus |

### è´¨é‡æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|---------|
| å•å…ƒæµ‹è¯•è¦†ç›–ç‡ | â‰¥ 80% | JaCoCo |
| ä»£ç é‡å¤ç‡ | < 5% | SonarQube |
| ä¸¥é‡Bugæ•° | 0 | Jira |
| å®‰å…¨æ¼æ´ | 0é«˜/ä¸­å± | å®‰å…¨æ‰«æ |

### è¿ç»´æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|---------|
| æœåŠ¡å¯ç”¨æ€§ | â‰¥ 99.9% | Uptimeç›‘æ§ |
| æ•…éšœæ¢å¤æ—¶é—´ | < 5åˆ†é’Ÿ | äº‹ä»¶è®°å½• |

---

## äº”ã€æ¯å‘¨äº¤ä»˜ç‰©æ¸…å• ğŸ“¦

### ç¬¬1å‘¨
- [ ] Java 21ç¯å¢ƒé…ç½®æ–‡æ¡£
- [ ] JWTå®‰å…¨ä¿®å¤ä»£ç 
- [ ] ç§Ÿæˆ·ä¸Šä¸‹æ–‡å¢å¼ºä»£ç 
- [ ] å®‰å…¨æµ‹è¯•æŠ¥å‘Š

### ç¬¬2å‘¨
- [ ] åè®®äº‹ä»¶æ¨¡å‹ä»£ç 
- [ ] RabbitMQé…ç½®æ–‡ä»¶
- [ ] åè®®é€‚é…å™¨å®ç°
- [ ] åè®®å¯¹æ¥æ–‡æ¡£

### ç¬¬4å‘¨
- [ ] Redisç¼“å­˜æœåŠ¡ä»£ç 
- [ ] å¯¹è´¦ä¼˜åŒ–ä»£ç 
- [ ] æ•°æ®åº“ç´¢å¼•DDLè„šæœ¬
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

### ç¬¬5å‘¨
- [ ] å‰ç«¯ç®¡ç†ç•Œé¢ä»£ç 
- [ ] å‰ç«¯éƒ¨ç½²æ–‡æ¡£

### ç¬¬6å‘¨
- [ ] ä»£ç è´¨é‡æ”¹è¿›æäº¤
- [ ] SonarQubeæ‰«ææŠ¥å‘Š
- [ ] TODOæ¸…ç†æ¸…å•

### ç¬¬8å‘¨
- [ ] å•å…ƒæµ‹è¯•ä»£ç ï¼ˆè¦†ç›–ç‡â‰¥80%ï¼‰
- [ ] é›†æˆæµ‹è¯•ä»£ç 
- [ ] å®Œæ•´APIæ–‡æ¡£
- [ ] éƒ¨ç½²è¿ç»´æ‰‹å†Œ
- [ ] å‘å¸ƒChecklist

---

## å…­ã€å»ºè®®çš„å·¥ä½œæµç¨‹ ğŸ”„

### æ¯æ—¥å·¥ä½œæµç¨‹
1. **09:00 - 09:15** ç«™ä¼šï¼ˆæ˜¨å¤©å®Œæˆã€ä»Šå¤©è®¡åˆ’ã€é˜»å¡é—®é¢˜ï¼‰
2. **09:15 - 12:00** ç¼–ç æ—¶é—´ï¼ˆ2-3å°æ—¶ä¸“æ³¨ç¼–ç ï¼‰
3. **12:00 - 13:30** åˆä¼‘
4. **13:30 - 15:00** ç»§ç»­ç¼–ç 
5. **15:00 - 16:00** ä»£ç å®¡æŸ¥/æµ‹è¯•
6. **16:00 - 17:00** æ–‡æ¡£æ›´æ–°/å­¦ä¹ æ—¶é—´
7. **17:00 - 17:30** æ—¥æŠ¥æäº¤

### æ¯å‘¨å·¥ä½œæµç¨‹
- **å‘¨ä¸€**: å‘¨è®¡åˆ’åˆ¶å®šï¼Œä»»åŠ¡åˆ†é…
- **å‘¨äºŒ-å‘¨å››**: ä¸“æ³¨å¼€å‘ï¼Œä»£ç å®¡æŸ¥
- **å‘¨äº”**: é›†æˆæµ‹è¯•ï¼Œå‘¨æŠ¥æ€»ç»“
- **å‘¨æœ«**: å¯é€‰åŠ ç­ï¼ˆç´§æ€¥æƒ…å†µï¼‰

---

## ä¸ƒã€ç«‹å³è¡ŒåŠ¨å»ºè®® ğŸš€

### ä»Šå¤©ï¼ˆ2025-10-11ï¼‰
- [x] å®Œæˆä¸‹ä¸€æ­¥å·¥ä½œè§„åˆ’æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- [ ] æ£€æŸ¥Javaç¯å¢ƒç‰ˆæœ¬
- [ ] é˜…è¯»JWTç™½åå•æ¼æ´ä»£ç 
- [ ] å‡†å¤‡ç¬¬1å‘¨ä»»åŠ¡æ¸…å•

### æ˜å¤©ï¼ˆ2025-10-12ï¼‰
- [ ] å¼€å§‹Javaç‰ˆæœ¬å‡çº§
- [ ] æ›´æ–°CI/CDé…ç½®
- [ ] éªŒè¯æ„å»ºé€šè¿‡

### æœ¬å‘¨å‰©ä½™æ—¶é—´ï¼ˆ2025-10-13 - 2025-10-15ï¼‰
- [ ] ä¿®å¤JWTç™½åå•æ¼æ´
- [ ] å®Œå–„ç§Ÿæˆ·ä¸Šä¸‹æ–‡æ¸…ç†
- [ ] ä¿®å¤å¼‚å¸¸å¤„ç†å™¨é¡ºåº
- [ ] ç¼–å†™å®‰å…¨æµ‹è¯•æŠ¥å‘Š

---

## å…«ã€å‚è€ƒæ–‡æ¡£ ğŸ“š

### é¡¹ç›®è§„åˆ’æ–‡æ¡£
- [ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’](./ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’.md) - è¯¦ç»†8å‘¨è®¡åˆ’
- [P3æ¯å‘¨è¡ŒåŠ¨æ¸…å•](./P3æ¯å‘¨è¡ŒåŠ¨æ¸…å•.md) - æ¯å‘¨ä»»åŠ¡æ¸…å•
- [PROGRESS.md](./PROGRESS.md) - è¿›åº¦è·Ÿè¸ª
- [ROADMAP.md](./ROADMAP.md) - é¡¹ç›®è·¯çº¿å›¾

### æŠ€æœ¯æ–‡æ¡£
- [DEVELOPMENT-PLAN.md](./DEVELOPMENT-PLAN.md) - å¼€å‘è®¡åˆ’
- [TECHNICAL-DESIGN.md](./TECHNICAL-DESIGN.md) - æŠ€æœ¯è®¾è®¡
- [MONITORING-GUIDE.md](./MONITORING-GUIDE.md) - ç›‘æ§æŒ‡å—
- [TESTING-GUIDE.md](./TESTING-GUIDE.md) - æµ‹è¯•æŒ‡å—

### å®Œæˆæ€»ç»“
- [M3-COMPLETION-SUMMARY.md](./M3-COMPLETION-SUMMARY.md) - æ”¯ä»˜é›†æˆå®Œæˆ
- [M7-COMPLETION-SUMMARY.md](./M7-COMPLETION-SUMMARY.md) - ç›‘æ§ä½“ç³»å®Œæˆ

---

## ä¹ã€è”ç³»æ–¹å¼ ğŸ“

**é¡¹ç›®ç»ç†**: [å¾…å¡«å†™]  
**æŠ€æœ¯è´Ÿè´£äºº**: [å¾…å¡«å†™]  
**ä¸‹æ¬¡è¯„å®¡**: 2025-10-18ï¼ˆç¬¬1å‘¨ç»“æŸï¼‰

---

## åã€æ€»ç»“ ğŸ“

### æ ¸å¿ƒè¦ç‚¹
1. **ç¬¬1å‘¨ï¼ˆå®‰å…¨åŠ å›ºï¼‰æ˜¯åŸºç¡€**ï¼Œå¿…é¡»å®Œæˆæ‰èƒ½ç»§ç»­åç»­å·¥ä½œ
2. **ç¬¬2å‘¨ï¼ˆåè®®å¯¹æ¥ï¼‰æ˜¯æ ¸å¿ƒ**ï¼Œå½±å“å……ç”µæ¡©ä¸šåŠ¡åŠŸèƒ½
3. **ç¬¬4å‘¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰æ˜¯å…³é”®**ï¼Œå†³å®šç³»ç»Ÿèƒ½å¦æ”¯æ’‘é«˜å¹¶å‘
4. **ç¬¬8å‘¨ï¼ˆæµ‹è¯•å‘å¸ƒï¼‰æ˜¯ä¿éšœ**ï¼Œç¡®ä¿è´¨é‡å’Œç¨³å®šæ€§

### å·¥ä½œé‡é¢„ä¼°
- ç¬¬1å‘¨: 14å°æ—¶
- ç¬¬2å‘¨: 34å°æ—¶
- ç¬¬4å‘¨: 30å°æ—¶
- ç¬¬5å‘¨: 20å°æ—¶
- ç¬¬6å‘¨: 20å°æ—¶
- ç¬¬8å‘¨: 40å°æ—¶
- **æ€»è®¡**: çº¦158å°æ—¶ï¼ˆçº¦20ä¸ªå·¥ä½œæ—¥ï¼‰

### å…³é”®æˆåŠŸå› ç´ 
1. **å®‰å…¨ç¬¬ä¸€**: P0é—®é¢˜ä¸è§£å†³ï¼Œä¸è¿›å…¥åç»­å¼€å‘
2. **å°æ­¥å¿«è·‘**: æ¯å‘¨æœ‰æ˜ç¡®äº¤ä»˜ç‰©å’ŒéªŒæ”¶æ ‡å‡†
3. **è´¨é‡ä¿è¯**: ä»£ç å®¡æŸ¥ + æµ‹è¯• + æ–‡æ¡£åŒæ­¥æ›´æ–°
4. **é£é™©ç®¡ç†**: æå‰è¯†åˆ«é£é™©ï¼Œå‡†å¤‡åº”å¯¹æ–¹æ¡ˆ
5. **å›¢é˜Ÿåä½œ**: åŠæ—¶æ²Ÿé€šï¼Œé‡åˆ°é—®é¢˜ç«‹å³å¯»æ±‚å¸®åŠ©

---

**æ–‡æ¡£ç»´æŠ¤äºº**: GitHub Copilot  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11  
**æœ€åæ›´æ–°**: 2025-10-11  
**ç‰ˆæœ¬**: v1.0

---

**ç¥é¡¹ç›®é¡ºåˆ©ï¼ğŸ‰**
